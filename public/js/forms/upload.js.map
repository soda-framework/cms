{"version":3,"sources":["fileinput.js","theme.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC56GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload.js","sourcesContent":["/*!\n * bootstrap-fileinput v4.3.8\n * http://plugins.krajee.com/file-input\n *\n * Author: Kartik Visweswaran\n * Copyright: 2014 - 2017, Kartik Visweswaran, Krajee.com\n *\n * Licensed under the BSD 3-Clause\n * https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md\n */\n(function (factory) {\n    \"use strict\";\n    //noinspection JSUnresolvedVariable\n    if (typeof define === 'function' && define.amd) { // jshint ignore:line\n        // AMD. Register as an anonymous module.\n        define(['jquery'], factory); // jshint ignore:line\n    } else { // noinspection JSUnresolvedVariable\n        if (typeof module === 'object' && module.exports) { // jshint ignore:line\n            // Node/CommonJS\n            // noinspection JSUnresolvedVariable\n            module.exports = factory(require('jquery')); // jshint ignore:line\n        } else {\n            // Browser globals\n            factory(window.jQuery);\n        }\n    }\n}(function ($) {\n    \"use strict\";\n\n    $.fn.fileinputLocales = {};\n    $.fn.fileinputThemes = {};\n\n    var $h, FileInput;\n\n    // fileinput helper object for all global variables and internal helper methods\n    //noinspection JSUnresolvedVariable\n    $h = {\n        NAMESPACE: '.fileinput',\n        MODAL_ID: 'kvFileinputModal',\n        FRAMES: '.kv-preview-thumb',\n        SORT_CSS: 'file-sortable',\n        STYLE_SETTING: 'style=\"width:{width};height:{height};\"',\n        OBJECT_PARAMS: '<param name=\"controller\" value=\"true\" />\\n' +\n        '<param name=\"allowFullScreen\" value=\"true\" />\\n' +\n        '<param name=\"allowScriptAccess\" value=\"always\" />\\n' +\n        '<param name=\"autoPlay\" value=\"false\" />\\n' +\n        '<param name=\"autoStart\" value=\"false\" />\\n' +\n        '<param name=\"quality\" value=\"high\" />\\n',\n        DEFAULT_PREVIEW: '<div class=\"file-preview-other\">\\n' +\n        '<span class=\"{previewFileIconClass}\">{previewFileIcon}</span>\\n' +\n        '</div>',\n        objUrl: window.URL || window.webkitURL,\n        compare: function (input, str, exact) {\n            return input !== undefined && (exact ? input === str : input.match(str));\n        },\n        handler: function ($el, event, callback, skipNS) {\n            var ev = skipNS ? event : event.split(' ').join($h.NAMESPACE + ' ') + $h.NAMESPACE;\n            if ($el.length) {\n                $el.off(ev).on(ev, callback);\n            }\n        },\n        isIE: function (ver) {\n            // check for IE versions < 11\n            if (navigator.appName !== 'Microsoft Internet Explorer') {\n                return false;\n            }\n            if (ver === 10) {\n                return new RegExp('msie\\\\s' + ver, 'i').test(navigator.userAgent);\n            }\n            var div = document.createElement(\"div\"), status;\n            div.innerHTML = \"<!--[if IE \" + ver + \"]> <i></i> <![endif]-->\";\n            status = div.getElementsByTagName(\"i\").length;\n            document.body.appendChild(div);\n            div.parentNode.removeChild(div);\n            return status;\n        },\n        isEmpty: function (value, trim) {\n            return value === undefined || value === null || value.length === 0 || (trim && $.trim(value) === '');\n        },\n        isArray: function (a) {\n            return Array.isArray(a) || Object.prototype.toString.call(a) === '[object Array]';\n        },\n        ifSet: function (needle, haystack, def) {\n            def = def || '';\n            return (haystack && typeof haystack === 'object' && needle in haystack) ? haystack[needle] : def;\n        },\n        getNum: function (num, def) {\n            def = def || 0;\n            if (typeof num === \"number\") {\n                return num;\n            }\n            if (typeof num === \"string\") {\n                num = parseFloat(num);\n            }\n            return isNaN(num) ? def : num;\n        },\n        hasFileAPISupport: function () {\n            return !!(window.File && window.FileReader);\n        },\n        hasDragDropSupport: function () {\n            var div = document.createElement('div');\n            /** @namespace div.draggable */\n            /** @namespace div.ondragstart */\n            /** @namespace div.ondrop */\n            return !$h.isIE(9) && (div.draggable !== undefined || (div.ondragstart !== undefined && div.ondrop !== undefined));\n        },\n        hasFileUploadSupport: function () {\n            return $h.hasFileAPISupport() && window.FormData;\n        },\n        addCss: function ($el, css) {\n            $el.removeClass(css).addClass(css);\n        },\n        getElement: function (options, param, value) {\n            return ($h.isEmpty(options) || $h.isEmpty(options[param])) ? value : $(options[param]);\n        },\n        uniqId: function () {\n            return Math.round(new Date().getTime() + (Math.random() * 100));\n        },\n        htmlEncode: function (str) {\n            return str.replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&apos;');\n        },\n        replaceTags: function (str, tags) {\n            var out = str;\n            if (!tags) {\n                return out;\n            }\n            $.each(tags, function (key, value) {\n                if (typeof value === \"function\") {\n                    value = value();\n                }\n                out = out.split(key).join(value);\n            });\n            return out;\n        },\n        cleanMemory: function ($thumb) {\n            var data = $thumb.is('img') ? $thumb.attr('src') : $thumb.find('source').attr('src');\n            /** @namespace $h.objUrl.revokeObjectURL */\n            $h.objUrl.revokeObjectURL(data);\n        },\n        findFileName: function (filePath) {\n            var sepIndex = filePath.lastIndexOf('/');\n            if (sepIndex === -1) {\n                sepIndex = filePath.lastIndexOf('\\\\');\n            }\n            return filePath.split(filePath.substring(sepIndex, sepIndex + 1)).pop();\n        },\n        checkFullScreen: function () {\n            //noinspection JSUnresolvedVariable\n            return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement ||\n                document.msFullscreenElement;\n        },\n        toggleFullScreen: function (maximize) {\n            var doc = document, de = doc.documentElement;\n            if (de && maximize && !$h.checkFullScreen()) {\n                /** @namespace document.requestFullscreen */\n                /** @namespace document.msRequestFullscreen */\n                /** @namespace document.mozRequestFullScreen */\n                /** @namespace document.webkitRequestFullscreen */\n                /** @namespace Element.ALLOW_KEYBOARD_INPUT */\n                if (de.requestFullscreen) {\n                    de.requestFullscreen();\n                } else if (de.msRequestFullscreen) {\n                    de.msRequestFullscreen();\n                } else if (de.mozRequestFullScreen) {\n                    de.mozRequestFullScreen();\n                } else if (de.webkitRequestFullscreen) {\n                    de.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                }\n            } else {\n                /** @namespace document.exitFullscreen */\n                /** @namespace document.msExitFullscreen */\n                /** @namespace document.mozCancelFullScreen */\n                /** @namespace document.webkitExitFullscreen */\n                if (doc.exitFullscreen) {\n                    doc.exitFullscreen();\n                } else if (doc.msExitFullscreen) {\n                    doc.msExitFullscreen();\n                } else if (doc.mozCancelFullScreen) {\n                    doc.mozCancelFullScreen();\n                } else if (doc.webkitExitFullscreen) {\n                    doc.webkitExitFullscreen();\n                }\n            }\n        },\n        moveArray: function (arr, oldIndex, newIndex) {\n            if (newIndex >= arr.length) {\n                var k = newIndex - arr.length;\n                while ((k--) + 1) {\n                    arr.push(undefined);\n                }\n            }\n            arr.splice(newIndex, 0, arr.splice(oldIndex, 1)[0]);\n            return arr;\n        },\n        cleanZoomCache: function ($el) {\n            var $cache = $el.closest('.kv-zoom-cache-theme');\n            if (!$cache.length) {\n                $cache = $el.closest('.kv-zoom-cache');\n            }\n            $cache.remove();\n        }\n    };\n    FileInput = function (element, options) {\n        var self = this;\n        self.$element = $(element);\n        if (!self._validate()) {\n            return;\n        }\n        self.isPreviewable = $h.hasFileAPISupport();\n        self.isIE9 = $h.isIE(9);\n        self.isIE10 = $h.isIE(10);\n        if (self.isPreviewable || self.isIE9) {\n            self._init(options);\n            self._listen();\n        } else {\n            self.$element.removeClass('file-loading');\n        }\n    };\n    FileInput.prototype = {\n        constructor: FileInput,\n        _init: function (options) {\n            var self = this, $el = self.$element, t;\n            self.options = options;\n            $.each(options, function (key, value) {\n                switch (key) {\n                    case 'minFileCount':\n                    case 'maxFileCount':\n                    case 'maxFileSize':\n                        self[key] = $h.getNum(value);\n                        break;\n                    default:\n                        self[key] = value;\n                        break;\n                }\n            });\n            self._initTemplateDefaults();\n            self.fileInputCleared = false;\n            self.fileBatchCompleted = true;\n            if (!self.isPreviewable) {\n                self.showPreview = false;\n            }\n            self.uploadFileAttr = !$h.isEmpty($el.attr('name')) ? $el.attr('name') : 'file_data';\n            self.reader = null;\n            self.formdata = {};\n            self.clearStack();\n            self.uploadCount = 0;\n            self.uploadStatus = {};\n            self.uploadLog = [];\n            self.uploadAsyncCount = 0;\n            self.loadedImages = [];\n            self.totalImagesCount = 0;\n            self.ajaxRequests = [];\n            self.isError = false;\n            self.ajaxAborted = false;\n            self.cancelling = false;\n            t = self._getLayoutTemplate('progress');\n            self.progressTemplate = t.replace('{class}', self.progressClass);\n            self.progressCompleteTemplate = t.replace('{class}', self.progressCompleteClass);\n            self.progressErrorTemplate = t.replace('{class}', self.progressErrorClass);\n            self.dropZoneEnabled = $h.hasDragDropSupport() && self.dropZoneEnabled;\n            self.isDisabled = self.$element.attr('disabled') || self.$element.attr('readonly');\n            self.isUploadable = $h.hasFileUploadSupport() && !$h.isEmpty(self.uploadUrl);\n            self.isClickable = self.browseOnZoneClick && self.showPreview &&\n                (self.isUploadable && self.dropZoneEnabled || !$h.isEmpty(self.defaultPreviewContent));\n            self.slug = typeof options.slugCallback === \"function\" ? options.slugCallback : self._slugDefault;\n            self.mainTemplate = self.showCaption ? self._getLayoutTemplate('main1') : self._getLayoutTemplate('main2');\n            self.captionTemplate = self._getLayoutTemplate('caption');\n            self.previewGenericTemplate = self._getPreviewTemplate('generic');\n            if (self.resizeImage && (self.maxImageWidth || self.maxImageHeight)) {\n                self.imageCanvas = document.createElement('canvas');\n                self.imageCanvasContext = self.imageCanvas.getContext('2d');\n            }\n            if ($h.isEmpty(self.$element.attr('id'))) {\n                self.$element.attr('id', $h.uniqId());\n            }\n            if (self.$container === undefined) {\n                self.$container = self._createContainer();\n            } else {\n                self._refreshContainer();\n            }\n            self.$dropZone = self.$container.find('.file-drop-zone');\n            self.$progress = self.$container.find('.kv-upload-progress');\n            self.$btnUpload = self.$container.find('.fileinput-upload');\n            self.$captionContainer = $h.getElement(options, 'elCaptionContainer', self.$container.find('.file-caption'));\n            self.$caption = $h.getElement(options, 'elCaptionText', self.$container.find('.file-caption-name'));\n            self.$previewContainer = $h.getElement(options, 'elPreviewContainer', self.$container.find('.file-preview'));\n            self.$preview = $h.getElement(options, 'elPreviewImage', self.$container.find('.file-preview-thumbnails'));\n            self.$previewStatus = $h.getElement(options, 'elPreviewStatus', self.$container.find('.file-preview-status'));\n            self.$errorContainer = $h.getElement(options, 'elErrorContainer',\n                self.$previewContainer.find('.kv-fileinput-error'));\n            if (!$h.isEmpty(self.msgErrorClass)) {\n                $h.addCss(self.$errorContainer, self.msgErrorClass);\n            }\n            self.$errorContainer.hide();\n            self.previewInitId = \"preview-\" + $h.uniqId();\n            self._initPreviewCache();\n            self._initPreview(true);\n            self._initPreviewActions();\n            self._setFileDropZoneTitle();\n            self.$element.removeClass('file-loading');\n            if (self.$element.attr('disabled')) {\n                self.disable();\n            }\n            self._initZoom();\n        },\n        _initTemplateDefaults: function () {\n            var self = this, tMain1, tMain2, tPreview, tFileIcon, tClose, tCaption, tBtnDefault, tBtnLink, tBtnBrowse,\n                tModalMain, tModal, tProgress, tSize, tFooter, tActions, tActionDelete, tActionUpload, tActionZoom,\n                tActionDrag, tTagBef, tTagBef1, tTagBef2, tTagAft, tGeneric, tHtml, tImage, tText, tVideo, tAudio,\n                tFlash, tObject, tPdf, tOther, tZoomCache;\n            tMain1 = '{preview}\\n' +\n                '<div class=\"kv-upload-progress hide\"></div>\\n' +\n                '<div class=\"input-group {class}\">\\n' +\n                '   {caption}\\n' +\n                '   <div class=\"input-group-btn\">\\n' +\n                '       {remove}\\n' +\n                '       {cancel}\\n' +\n                '       {upload}\\n' +\n                '       {browse}\\n' +\n                '   </div>\\n' +\n                '</div>';\n            tMain2 = '{preview}\\n<div class=\"kv-upload-progress hide\"></div>\\n{remove}\\n{cancel}\\n{upload}\\n{browse}\\n';\n            tPreview = '<div class=\"file-preview {class}\">\\n' +\n                '    {close}' +\n                '    <div class=\"{dropClass}\">\\n' +\n                '    <div class=\"file-preview-thumbnails\">\\n' +\n                '    </div>\\n' +\n                '    <div class=\"clearfix\"></div>' +\n                '    <div class=\"file-preview-status text-center text-success\"></div>\\n' +\n                '    <div class=\"kv-fileinput-error\"></div>\\n' +\n                '    </div>\\n' +\n                '</div>';\n            tClose = '<div class=\"close fileinput-remove\">&times;</div>\\n';\n            tFileIcon = '<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>';\n            tCaption = '<div tabindex=\"500\" class=\"form-control file-caption {class}\">\\n' +\n                '   <div class=\"file-caption-name\"></div>\\n' +\n                '</div>\\n';\n            //noinspection HtmlUnknownAttribute\n            tBtnDefault = '<button type=\"{type}\" tabindex=\"500\" title=\"{title}\" class=\"{css}\" ' +\n                '{status}>{icon} {label}</button>';\n            //noinspection HtmlUnknownAttribute\n            tBtnLink = '<a href=\"{href}\" tabindex=\"500\" title=\"{title}\" class=\"{css}\" {status}>{icon} {label}</a>';\n            //noinspection HtmlUnknownAttribute\n            tBtnBrowse = '<div tabindex=\"500\" class=\"{css}\" {status}>{icon} {label}</div>';\n            tModalMain = '<div id=\"' + $h.MODAL_ID + '\" class=\"file-zoom-dialog modal fade\" ' +\n                'tabindex=\"-1\" aria-labelledby=\"' + $h.MODAL_ID + 'Label\"></div>';\n            tModal = '<div class=\"modal-dialog modal-lg\" role=\"document\">\\n' +\n                '  <div class=\"modal-content\">\\n' +\n                '    <div class=\"modal-header\">\\n' +\n                '      <div class=\"kv-zoom-actions pull-right\">{toggleheader}{fullscreen}{borderless}{close}</div>\\n' +\n                '      <h3 class=\"modal-title\">{heading} <small><span class=\"kv-zoom-title\"></span></small></h3>\\n' +\n                '    </div>\\n' +\n                '    <div class=\"modal-body\">\\n' +\n                '      <div class=\"floating-buttons\"></div>\\n' +\n                '      <div class=\"kv-zoom-body file-zoom-content\"></div>\\n' + '{prev} {next}\\n' +\n                '    </div>\\n' +\n                '  </div>\\n' +\n                '</div>\\n';\n            tProgress = '<div class=\"progress\">\\n' +\n                '    <div class=\"{class}\" role=\"progressbar\"' +\n                ' aria-valuenow=\"{percent}\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width:{percent}%;\">\\n' +\n                '        {percent}%\\n' +\n                '     </div>\\n' +\n                '</div>';\n            tSize = ' <samp>({sizeText})</samp>';\n            tFooter = '<div class=\"file-thumbnail-footer\">\\n' +\n                '    <div class=\"file-footer-caption\" title=\"{caption}\">{caption}<br>{size}</div>\\n' +\n                '    {progress} {actions}\\n' +\n                '</div>';\n            tActions = '<div class=\"file-upload-indicator\" title=\"{indicatorTitle}\">{indicator}</div>\\n' +\n                '{drag}\\n' +\n                '<div class=\"file-actions\">\\n' +\n                '    <div class=\"file-footer-buttons\">\\n' +\n                '        {upload} {delete} {zoom} {other}' +\n                '    </div>\\n' +\n                '    <div class=\"clearfix\"></div>\\n' +\n                '</div>';\n            //noinspection HtmlUnknownAttribute\n            tActionDelete = '<button type=\"button\" class=\"kv-file-remove {removeClass}\" ' +\n                'title=\"{removeTitle}\" {dataUrl}{dataKey}>{removeIcon}</button>\\n';\n            tActionUpload = '<button type=\"button\" class=\"kv-file-upload {uploadClass}\" title=\"{uploadTitle}\">' +\n                '{uploadIcon}</button>';\n            tActionZoom = '<button type=\"button\" class=\"kv-file-zoom {zoomClass}\" ' +\n                'title=\"{zoomTitle}\">{zoomIcon}</button>';\n            tActionDrag = '<span class=\"file-drag-handle {dragClass}\" title=\"{dragTitle}\">{dragIcon}</span>';\n            tTagBef = '<div class=\"file-preview-frame {frameClass}\" id=\"{previewId}\" data-fileindex=\"{fileindex}\"' +\n                ' data-template=\"{template}\"';\n            tTagBef1 = tTagBef + '><div class=\"kv-file-content\">\\n';\n            tTagBef2 = tTagBef + ' title=\"{caption}\"><div class=\"kv-file-content\">\\n';\n            tTagAft = '</div>{footer}\\n</div>\\n';\n            tGeneric = '{content}\\n';\n            tHtml = '<div class=\"kv-preview-data file-preview-html\" title=\"{caption}\" ' + $h.STYLE_SETTING +\n                '>{data}</div>\\n';\n            tImage = '<img src=\"{data}\" class=\"file-preview-image kv-preview-data\" title=\"{caption}\" alt=\"{caption}\" ' +\n                $h.STYLE_SETTING + '>\\n';\n            tText = '<textarea class=\"kv-preview-data file-preview-text\" title=\"{caption}\" readonly ' +\n                $h.STYLE_SETTING + '>{data}</textarea>\\n';\n            tVideo = '<video class=\"kv-preview-data file-preview-video\" width=\"{width}\" '  +\n                'height=\"{height}\" controls>\\n' + '<source src=\"{data}\" type=\"{type}\">\\n' + $h.DEFAULT_PREVIEW +\n                '\\n</video>\\n';\n            tAudio = '<div class=\"file-preview-audio\"><audio class=\"kv-preview-data\" controls>\\n<source src=\"{data}\" ' +\n                'type=\"{type}\">\\n' + $h.DEFAULT_PREVIEW + '\\n</audio></div>\\n';\n            tFlash = '<object class=\"kv-preview-data file-object\" type=\"application/x-shockwave-flash\" ' +\n                'width=\"{width}\" height=\"{height}\" data=\"{data}\">\\n' + $h.OBJECT_PARAMS + ' ' + $h.DEFAULT_PREVIEW +\n                '\\n</object>\\n';\n            tObject = '<object class=\"kv-preview-data file-object\" data=\"{data}\" type=\"{type}\" ' +\n                'width=\"{width}\" height=\"{height}\">\\n' + '<param name=\"movie\" value=\"{caption}\" />\\n' +\n                $h.OBJECT_PARAMS + ' ' + $h.DEFAULT_PREVIEW + '\\n</object>\\n';\n            tPdf = '<embed class=\"kv-preview-data\" src=\"{data}\" ' +\n                'width=\"{width}\" height=\"{height}\" type=\"application/pdf\">\\n';\n            tOther = '<div class=\"kv-preview-data file-preview-other-frame\">\\n' + $h.DEFAULT_PREVIEW + '\\n</div>\\n';\n            tZoomCache = '<div class=\"kv-zoom-cache\" style=\"display:none\">{zoomContent}</div>';\n            self.defaults = {\n                layoutTemplates: {\n                    main1: tMain1,\n                    main2: tMain2,\n                    preview: tPreview,\n                    close: tClose,\n                    fileIcon: tFileIcon,\n                    caption: tCaption,\n                    modalMain: tModalMain,\n                    modal: tModal,\n                    progress: tProgress,\n                    size: tSize,\n                    footer: tFooter,\n                    actions: tActions,\n                    actionDelete: tActionDelete,\n                    actionUpload: tActionUpload,\n                    actionZoom: tActionZoom,\n                    actionDrag: tActionDrag,\n                    btnDefault: tBtnDefault,\n                    btnLink: tBtnLink,\n                    btnBrowse: tBtnBrowse,\n                    zoomCache: tZoomCache\n                },\n                previewMarkupTags: {\n                    tagBefore1: tTagBef1,\n                    tagBefore2: tTagBef2,\n                    tagAfter: tTagAft\n                },\n                previewContentTemplates: {\n                    generic: tGeneric,\n                    html: tHtml,\n                    image: tImage,\n                    text: tText,\n                    video: tVideo,\n                    audio: tAudio,\n                    flash: tFlash,\n                    object: tObject,\n                    pdf: tPdf,\n                    other: tOther\n                },\n                allowedPreviewTypes: ['image', 'html', 'text', 'video', 'audio', 'flash', 'pdf', 'object'],\n                previewTemplates: {},\n                previewSettings: {\n                    image: {width: \"auto\", height: \"160px\"},\n                    html: {width: \"213px\", height: \"160px\"},\n                    text: {width: \"213px\", height: \"160px\"},\n                    video: {width: \"213px\", height: \"160px\"},\n                    audio: {width: \"213px\", height: \"80px\"},\n                    flash: {width: \"213px\", height: \"160px\"},\n                    object: {width: \"160px\", height: \"auto\"},\n                    pdf: {width: \"160px\", height: \"160px\"},\n                    other: {width: \"160px\", height: \"160px\"}\n                },\n                previewZoomSettings: {\n                    image: {width: \"auto\", height: \"auto\", 'max-width': \"100%\", 'max-height': \"100%\"},\n                    html: {width: \"100%\", height: \"100%\", 'min-height': \"480px\"},\n                    text: {width: \"100%\", height: \"100%\", 'min-height': \"480px\"},\n                    video: {width: \"auto\", height: \"100%\", 'max-width': \"100%\"},\n                    audio: {width: \"100%\", height: \"30px\"},\n                    flash: {width: \"auto\", height: \"480px\"},\n                    object: {width: \"auto\", height: \"100%\", 'min-height': \"480px\"},\n                    pdf: {width: \"100%\", height: \"100%\", 'min-height': \"480px\"},\n                    other: {width: \"auto\", height: \"100%\", 'min-height': \"480px\"}\n                },\n                fileTypeSettings: {\n                    image: function (vType, vName) {\n                        return $h.compare(vType, 'image.*') || $h.compare(vName, /\\.(gif|png|jpe?g)$/i);\n                    },\n                    html: function (vType, vName) {\n                        return $h.compare(vType, 'text/html') || $h.compare(vName, /\\.(htm|html)$/i);\n                    },\n                    text: function (vType, vName) {\n                        return $h.compare(vType, 'text.*') || $h.compare(vName, /\\.(xml|javascript)$/i) ||\n                            $h.compare(vName, /\\.(txt|md|csv|nfo|ini|json|php|js|css)$/i);\n                    },\n                    video: function (vType, vName) {\n                        return $h.compare(vType, 'video.*') && ($h.compare(vType, /(ogg|mp4|mp?g|mov|webm|3gp)$/i) ||\n                            $h.compare(vName, /\\.(og?|mp4|webm|mp?g|mov|3gp)$/i));\n                    },\n                    audio: function (vType, vName) {\n                        return $h.compare(vType, 'audio.*') && ($h.compare(vName, /(ogg|mp3|mp?g|wav)$/i) ||\n                            $h.compare(vName, /\\.(og?|mp3|mp?g|wav)$/i));\n                    },\n                    flash: function (vType, vName) {\n                        return $h.compare(vType, 'application/x-shockwave-flash', true) || $h.compare(vName, /\\.(swf)$/i);\n                    },\n                    pdf: function (vType, vName) {\n                        return $h.compare(vType, 'application/pdf', true) || $h.compare(vName, /\\.(pdf)$/i);\n                    },\n                    object: function () {\n                        return true;\n                    },\n                    other: function () {\n                        return true;\n                    }\n                },\n                fileActionSettings: {\n                    showRemove: true,\n                    showUpload: true,\n                    showZoom: true,\n                    showDrag: true,\n                    removeIcon: '<i class=\"glyphicon glyphicon-trash text-danger\"></i>',\n                    removeClass: 'btn btn-xs btn-default',\n                    removeTitle: 'Remove file',\n                    uploadIcon: '<i class=\"glyphicon glyphicon-upload text-info\"></i>',\n                    uploadClass: 'btn btn-xs btn-default',\n                    uploadTitle: 'Upload file',\n                    zoomIcon: '<i class=\"glyphicon glyphicon-zoom-in\"></i>',\n                    zoomClass: 'btn btn-xs btn-default',\n                    zoomTitle: 'View Details',\n                    dragIcon: '<i class=\"glyphicon glyphicon-menu-hamburger\"></i>',\n                    dragClass: 'text-info',\n                    dragTitle: 'Move / Rearrange',\n                    dragSettings: {},\n                    indicatorNew: '<i class=\"glyphicon glyphicon-hand-down text-warning\"></i>',\n                    indicatorSuccess: '<i class=\"glyphicon glyphicon-ok-sign text-success\"></i>',\n                    indicatorError: '<i class=\"glyphicon glyphicon-exclamation-sign text-danger\"></i>',\n                    indicatorLoading: '<i class=\"glyphicon glyphicon-hand-up text-muted\"></i>',\n                    indicatorNewTitle: 'Not uploaded yet',\n                    indicatorSuccessTitle: 'Uploaded',\n                    indicatorErrorTitle: 'Upload Error',\n                    indicatorLoadingTitle: 'Uploading ...'\n                }\n            };\n            $.each(self.defaults, function (key, setting) {\n                if (key === 'allowedPreviewTypes') {\n                    if (self.allowedPreviewTypes === undefined) {\n                        self.allowedPreviewTypes = setting;\n                    }\n                    return;\n                }\n                self[key] = $.extend(true, {}, setting, self[key]);\n            });\n            self._initPreviewTemplates();\n        },\n        _initPreviewTemplates: function () {\n            var self = this, cfg = self.defaults, tags = self.previewMarkupTags, tagBef, tagAft = tags.tagAfter;\n            $.each(cfg.previewContentTemplates, function (key, value) {\n                if ($h.isEmpty(self.previewTemplates[key])) {\n                    tagBef = tags.tagBefore2;\n                    if (key === 'generic' || key === 'image' || key === 'html' || key === 'text') {\n                        tagBef = tags.tagBefore1;\n                    }\n                    self.previewTemplates[key] = tagBef + value + tagAft;\n                }\n            });\n        },\n        _initPreviewCache: function () {\n            var self = this;\n            self.previewCache = {\n                data: {},\n                init: function () {\n                    var content = self.initialPreview;\n                    if (content.length > 0 && !$h.isArray(content)) {\n                        content = content.split(self.initialPreviewDelimiter);\n                    }\n                    self.previewCache.data = {\n                        content: content,\n                        config: self.initialPreviewConfig,\n                        tags: self.initialPreviewThumbTags\n                    };\n                },\n                fetch: function () {\n                    return self.previewCache.data.content.filter(function (n) {\n                        return n !== null;\n                    });\n                },\n                count: function (all) {\n                    return !!self.previewCache.data && !!self.previewCache.data.content ?\n                        (all ? self.previewCache.data.content.length : self.previewCache.fetch().length) : 0;\n                },\n                get: function (i, isDisabled) {\n                    var ind = 'init_' + i, data = self.previewCache.data, config = data.config[i],\n                        content = data.content[i], previewId = self.previewInitId + '-' + ind, out, $tmp, cat, ftr,\n                        fname, ftype, frameClass, asData = $h.ifSet('previewAsData', config, self.initialPreviewAsData),\n                        parseTemplate = function (cat, dat, fn, ft, id, ftr, ind, fc, t) {\n                            fc = ' file-preview-initial ' + $h.SORT_CSS + (fc ? ' ' + fc : '');\n                            return self._generatePreviewTemplate(cat, dat, fn, ft, id, false, null, fc, ftr, ind, t);\n                        };\n                    if (!content) {\n                        return '';\n                    }\n                    isDisabled = isDisabled === undefined ? true : isDisabled;\n                    cat = $h.ifSet('type', config, self.initialPreviewFileType || 'generic');\n                    fname = $h.ifSet('filename', config, $h.ifSet('caption', config));\n                    ftype = $h.ifSet('filetype', config, cat);\n                    ftr = self.previewCache.footer(i, isDisabled, (config && config.size || null));\n                    frameClass = $h.ifSet('frameClass', config);\n                    if (asData) {\n                        out = parseTemplate(cat, content, fname, ftype, previewId, ftr, ind, frameClass);\n                    } else {\n                        out = parseTemplate('generic', content, fname, ftype, previewId, ftr, ind, frameClass, cat)\n                            .replace(/\\{content}/g, data.content[i]);\n                    }\n                    if (data.tags.length && data.tags[i]) {\n                        out = $h.replaceTags(out, data.tags[i]);\n                    }\n                    /** @namespace config.frameAttr */\n                    if (!$h.isEmpty(config) && !$h.isEmpty(config.frameAttr)) {\n                        $tmp = $(document.createElement('div')).html(out);\n                        $tmp.find('.file-preview-initial').attr(config.frameAttr);\n                        out = $tmp.html();\n                        $tmp.remove();\n                    }\n                    return out;\n                },\n                add: function (content, config, tags, append) {\n                    var data = self.previewCache.data, index;\n                    if (!$h.isArray(content)) {\n                        content = content.split(self.initialPreviewDelimiter);\n                    }\n                    if (append) {\n                        index = data.content.push(content) - 1;\n                        data.config[index] = config;\n                        data.tags[index] = tags;\n                    } else {\n                        index = content.length - 1;\n                        data.content = content;\n                        data.config = config;\n                        data.tags = tags;\n                    }\n                    self.previewCache.data = data;\n                    return index;\n                },\n                set: function (content, config, tags, append) {\n                    var data = self.previewCache.data, i, chk;\n                    if (!content || !content.length) {\n                        return;\n                    }\n                    if (!$h.isArray(content)) {\n                        content = content.split(self.initialPreviewDelimiter);\n                    }\n                    chk = content.filter(function (n) {\n                        return n !== null;\n                    });\n                    if (!chk.length) {\n                        return;\n                    }\n                    if (data.content === undefined) {\n                        data.content = [];\n                    }\n                    if (data.config === undefined) {\n                        data.config = [];\n                    }\n                    if (data.tags === undefined) {\n                        data.tags = [];\n                    }\n                    if (append) {\n                        for (i = 0; i < content.length; i++) {\n                            if (content[i]) {\n                                data.content.push(content[i]);\n                            }\n                        }\n                        for (i = 0; i < config.length; i++) {\n                            if (config[i]) {\n                                data.config.push(config[i]);\n                            }\n                        }\n                        for (i = 0; i < tags.length; i++) {\n                            if (tags[i]) {\n                                data.tags.push(tags[i]);\n                            }\n                        }\n                    } else {\n                        data.content = content;\n                        data.config = config;\n                        data.tags = tags;\n                    }\n                    self.previewCache.data = data;\n                },\n                unset: function (index) {\n                    var chk = self.previewCache.count();\n                    if (!chk) {\n                        return;\n                    }\n                    if (chk === 1) {\n                        self.previewCache.data.content = [];\n                        self.previewCache.data.config = [];\n                        self.previewCache.data.tags = [];\n                        self.initialPreview = [];\n                        self.initialPreviewConfig = [];\n                        self.initialPreviewThumbTags = [];\n                        return;\n                    }\n                    self.previewCache.data.content[index] = null;\n                    self.previewCache.data.config[index] = null;\n                    self.previewCache.data.tags[index] = null;\n                },\n                out: function () {\n                    var html = '', caption, len = self.previewCache.count(true), i;\n                    if (len === 0) {\n                        return {content: '', caption: ''};\n                    }\n                    for (i = 0; i < len; i++) {\n                        html += self.previewCache.get(i);\n                    }\n                    caption = self._getMsgSelected(self.previewCache.count());\n                    return {content: html, caption: caption};\n                },\n                footer: function (i, isDisabled, size) {\n                    var data = self.previewCache.data;\n                    if (!data || !data.config || data.config.length === 0 || $h.isEmpty(data.config[i])) {\n                        return '';\n                    }\n                    isDisabled = isDisabled === undefined ? true : isDisabled;\n                    var config = data.config[i], caption = $h.ifSet('caption', config), actions = '',\n                        width = $h.ifSet('width', config, 'auto'), url = $h.ifSet('url', config, false),\n                        key = $h.ifSet('key', config, null), fs = self.fileActionSettings,\n                        showDel = $h.ifSet('showDelete', config, true), showZoom = $h.ifSet('showZoom', config, fs.showZoom),\n                        showDrag = $h.ifSet('showDrag', config, fs.showDrag), disabled = (url === false) && isDisabled;\n                    if (self.initialPreviewShowDelete) {\n                        actions = self._renderFileActions(false, showDel, showZoom, showDrag, disabled, url, key, true);\n                    }\n                    return self._getLayoutTemplate('footer').replace(/\\{progress}/g, self._renderThumbProgress())\n                        .replace(/\\{actions}/g, actions).replace(/\\{caption}/g, caption)\n                        .replace(/\\{size}/g, self._getSize(size)).replace(/\\{width}/g, width)\n                        .replace(/\\{indicator}/g, '').replace(/\\{indicatorTitle}/g, '');\n                }\n            };\n            self.previewCache.init();\n        },\n        _log: function (msg) {\n            var self = this, id = self.$element.attr('id');\n            if (id) {\n                msg = '\"' + id + '\": ' + msg;\n            }\n            if (typeof window.console.log !== \"undefined\") {\n                window.console.log(msg);\n            } else {\n                window.alert(msg);\n            }\n        },\n        _validate: function () {\n            var self = this, status = self.$element.attr('type') === 'file';\n            if (!status) {\n                self._log('The input \"type\" must be set to \"file\" for initializing the \"bootstrap-fileinput\" plugin.');\n            }\n            return status;\n        },\n        _errorsExist: function () {\n            var self = this, $err;\n            if (self.$errorContainer.find('li').length) {\n                return true;\n            }\n            $err = $(document.createElement('div')).html(self.$errorContainer.html());\n            $err.find('span.kv-error-close').remove();\n            $err.find('ul').remove();\n            return $.trim($err.text()).length ? true : false;\n        },\n        _errorHandler: function (evt, caption) {\n            var self = this, err = evt.target.error;\n            /** @namespace err.NOT_FOUND_ERR */\n            /** @namespace err.SECURITY_ERR */\n            /** @namespace err.NOT_READABLE_ERR */\n            if (err.code === err.NOT_FOUND_ERR) {\n                self._showError(self.msgFileNotFound.replace('{name}', caption));\n            } else if (err.code === err.SECURITY_ERR) {\n                self._showError(self.msgFileSecured.replace('{name}', caption));\n            } else if (err.code === err.NOT_READABLE_ERR) {\n                self._showError(self.msgFileNotReadable.replace('{name}', caption));\n            } else if (err.code === err.ABORT_ERR) {\n                self._showError(self.msgFilePreviewAborted.replace('{name}', caption));\n            } else {\n                self._showError(self.msgFilePreviewError.replace('{name}', caption));\n            }\n        },\n        _addError: function (msg) {\n            var self = this, $error = self.$errorContainer;\n            if (msg && $error.length) {\n                $error.html(self.errorCloseButton + msg);\n                $h.handler($error.find('.kv-error-close'), 'click', function () {\n                    $error.fadeOut('slow');\n                });\n            }\n        },\n        _resetErrors: function (fade) {\n            var self = this, $error = self.$errorContainer;\n            self.isError = false;\n            self.$container.removeClass('has-error');\n            $error.html('');\n            if (fade) {\n                $error.fadeOut('slow');\n            } else {\n                $error.hide();\n            }\n        },\n        _showFolderError: function (folders) {\n            var self = this, $error = self.$errorContainer, msg;\n            if (!folders) {\n                return;\n            }\n            msg = self.msgFoldersNotAllowed.replace(/\\{n}/g, folders);\n            self._addError(msg);\n            $h.addCss(self.$container, 'has-error');\n            $error.fadeIn(800);\n            self._raise('filefoldererror', [folders, msg]);\n        },\n        _showUploadError: function (msg, params, event) {\n            var self = this, $error = self.$errorContainer, ev = event || 'fileuploaderror', e = params && params.id ?\n            '<li data-file-id=\"' + params.id + '\">' + msg + '</li>' : '<li>' + msg + '</li>';\n            if ($error.find('ul').length === 0) {\n                self._addError('<ul>' + e + '</ul>');\n            } else {\n                $error.find('ul').append(e);\n            }\n            $error.fadeIn(800);\n            self._raise(ev, [params, msg]);\n            self.$container.removeClass('file-input-new');\n            $h.addCss(self.$container, 'has-error');\n            return true;\n        },\n        _showError: function (msg, params, event) {\n            var self = this, $error = self.$errorContainer, ev = event || 'fileerror';\n            params = params || {};\n            params.reader = self.reader;\n            self._addError(msg);\n            $error.fadeIn(800);\n            self._raise(ev, [params, msg]);\n            if (!self.isUploadable) {\n                self._clearFileInput();\n            }\n            self.$container.removeClass('file-input-new');\n            $h.addCss(self.$container, 'has-error');\n            self.$btnUpload.attr('disabled', true);\n            return true;\n        },\n        _noFilesError: function (params) {\n            var self = this, label = self.minFileCount > 1 ? self.filePlural : self.fileSingle,\n                msg = self.msgFilesTooLess.replace('{n}', self.minFileCount).replace('{files}', label),\n                $error = self.$errorContainer;\n            self._addError(msg);\n            self.isError = true;\n            self._updateFileDetails(0);\n            $error.fadeIn(800);\n            self._raise('fileerror', [params, msg]);\n            self._clearFileInput();\n            $h.addCss(self.$container, 'has-error');\n        },\n        _parseError: function (operation, jqXHR, errorThrown, fileName) {\n            /** @namespace jqXHR.responseJSON */\n            var self = this, errMsg = $.trim(errorThrown + ''), dot = errMsg.slice(-1) === '.' ? '' : '.',\n                text = jqXHR.responseJSON !== undefined && jqXHR.responseJSON.error !== undefined ?\n                    jqXHR.responseJSON.error : jqXHR.responseText;\n            if (self.cancelling && self.msgUploadAborted) {\n                errMsg = self.msgUploadAborted;\n            }\n            if (self.showAjaxErrorDetails && text) {\n                text = $.trim(text.replace(/\\n\\s*\\n/g, '\\n'));\n                text = text.length > 0 ? '<pre>' + text + '</pre>' : '';\n                errMsg += dot + text;\n            } else {\n                errMsg += dot;\n            }\n            if (errMsg === dot) {\n                errMsg = self.msgAjaxError.replace('{operation}', operation);\n            }\n            self.cancelling = false;\n            return fileName ? '<b>' + fileName + ': </b>' + errMsg : errMsg;\n        },\n        _parseFileType: function (file) {\n            var self = this, isValid, vType, cat, i, types = self.allowedPreviewTypes;\n            for (i = 0; i < types.length; i++) {\n                cat = types[i];\n                isValid = self.fileTypeSettings[cat];\n                vType = isValid(file.type, file.name) ? cat : '';\n                if (!$h.isEmpty(vType)) {\n                    return vType;\n                }\n            }\n            return 'other';\n        },\n        _getPreviewIcon: function (fname) {\n            var self = this, ext, out = null;\n            if (fname && fname.indexOf('.') > -1) {\n                ext = fname.split('.').pop();\n                if (self.previewFileIconSettings && self.previewFileIconSettings[ext]) {\n                    out = self.previewFileIconSettings[ext];\n                }\n                if (self.previewFileExtSettings) {\n                    $.each(self.previewFileExtSettings, function (key, func) {\n                        if (self.previewFileIconSettings[key] && func(ext)) {\n                            out = self.previewFileIconSettings[key];\n                            //noinspection UnnecessaryReturnStatementJS\n                            return;\n                        }\n                    });\n                }\n            }\n            return out;\n        },\n        _parseFilePreviewIcon: function (content, fname) {\n            var self = this, icn = self._getPreviewIcon(fname) || self.previewFileIcon;\n            if (content.indexOf('{previewFileIcon}') > -1) {\n                content = content.replace(/\\{previewFileIconClass}/g, self.previewFileIconClass).replace(\n                    /\\{previewFileIcon}/g, icn);\n            }\n            return content;\n        },\n        _raise: function (event, params) {\n            var self = this, e = $.Event(event);\n            if (params !== undefined) {\n                self.$element.trigger(e, params);\n            } else {\n                self.$element.trigger(e);\n            }\n            if (e.isDefaultPrevented()) {\n                return false;\n            }\n            if (!e.result) {\n                return e.result;\n            }\n            switch (event) {\n                // ignore these events\n                case 'filebatchuploadcomplete':\n                case 'filebatchuploadsuccess':\n                case 'fileuploaded':\n                case 'fileclear':\n                case 'filecleared':\n                case 'filereset':\n                case 'fileerror':\n                case 'filefoldererror':\n                case 'fileuploaderror':\n                case 'filebatchuploaderror':\n                case 'filedeleteerror':\n                case 'filecustomerror':\n                case 'filesuccessremove':\n                    break;\n                // receive data response via `filecustomerror` event`\n                default:\n                    self.ajaxAborted = e.result;\n                    break;\n            }\n            return true;\n        },\n        _listenFullScreen: function (isFullScreen) {\n            var self = this, $modal = self.$modal, $btnFull, $btnBord;\n            if (!$modal || !$modal.length) {\n                return;\n            }\n            $btnFull = $modal && $modal.find('.btn-fullscreen');\n            $btnBord = $modal && $modal.find('.btn-borderless');\n            if (!$btnFull.length || !$btnBord.length) {\n                return;\n            }\n            $btnFull.removeClass('active').attr('aria-pressed', 'false');\n            $btnBord.removeClass('active').attr('aria-pressed', 'false');\n            if (isFullScreen) {\n                $btnFull.addClass('active').attr('aria-pressed', 'true');\n            } else {\n                $btnBord.addClass('active').attr('aria-pressed', 'true');\n            }\n            if ($modal.hasClass('file-zoom-fullscreen')) {\n                self._maximizeZoomDialog();\n            } else {\n                if (isFullScreen) {\n                    self._maximizeZoomDialog();\n                } else {\n                    $btnBord.removeClass('active').attr('aria-pressed', 'false');\n                }\n            }\n        },\n        _listen: function () {\n            var self = this, $el = self.$element, $form = $el.closest('form'), $cont = self.$container;\n            $h.handler($el, 'change', $.proxy(self._change, self));\n            if (self.showBrowse) {\n                $h.handler(self.$btnFile, 'click', $.proxy(self._browse, self));\n            }\n            $h.handler($form, 'reset', $.proxy(self.reset, self));\n            $h.handler($cont.find('.fileinput-remove:not([disabled])'), 'click', $.proxy(self.clear, self));\n            $h.handler($cont.find('.fileinput-cancel'), 'click', $.proxy(self.cancel, self));\n            self._initDragDrop();\n            if (!self.isUploadable) {\n                $h.handler($form, 'submit', $.proxy(self._submitForm, self));\n            }\n            $h.handler(self.$container.find('.fileinput-upload'), 'click', $.proxy(self._uploadClick, self));\n            $h.handler($(window), 'resize', function () {\n                self._listenFullScreen(screen.width === window.innerWidth && screen.height === window.innerHeight);\n            });\n            $h.handler($(document), 'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange',\n                function () {\n                    self._listenFullScreen($h.checkFullScreen());\n                });\n            self._initClickable();\n        },\n        _initClickable: function () {\n            var self = this, $zone;\n            if (!self.isClickable) {\n                return;\n            }\n            $zone = self.isUploadable ? self.$dropZone : self.$preview.find('.file-default-preview');\n            $h.addCss($zone, 'clickable');\n            $zone.attr('tabindex', -1);\n            $h.handler($zone, 'click', function (e) {\n                var $tar = $(e.target);\n                if (!$tar.parents('.file-preview-thumbnails').length || $tar.parents('.file-default-preview').length) {\n                    self.$element.trigger('click');\n                    $zone.blur();\n                }\n            });\n        },\n        _initDragDrop: function () {\n            var self = this, $zone = self.$dropZone;\n            if (self.isUploadable && self.dropZoneEnabled && self.showPreview) {\n                $h.handler($zone, 'dragenter dragover', $.proxy(self._zoneDragEnter, self));\n                $h.handler($zone, 'dragleave', $.proxy(self._zoneDragLeave, self));\n                $h.handler($zone, 'drop', $.proxy(self._zoneDrop, self));\n                $h.handler($(document), 'dragenter dragover drop', self._zoneDragDropInit);\n            }\n        },\n        _zoneDragDropInit: function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n        },\n        _zoneDragEnter: function (e) {\n            var self = this, hasFiles = $.inArray('Files', e.originalEvent.dataTransfer.types) > -1;\n            self._zoneDragDropInit(e);\n            if (self.isDisabled || !hasFiles) {\n                e.originalEvent.dataTransfer.effectAllowed = 'none';\n                e.originalEvent.dataTransfer.dropEffect = 'none';\n                return;\n            }\n            $h.addCss(self.$dropZone, 'file-highlighted');\n        },\n        _zoneDragLeave: function (e) {\n            var self = this;\n            self._zoneDragDropInit(e);\n            if (self.isDisabled) {\n                return;\n            }\n            self.$dropZone.removeClass('file-highlighted');\n        },\n        _zoneDrop: function (e) {\n            var self = this;\n            e.preventDefault();\n            /** @namespace e.originalEvent.dataTransfer */\n            if (self.isDisabled || $h.isEmpty(e.originalEvent.dataTransfer.files)) {\n                return;\n            }\n            self._change(e, 'dragdrop');\n            self.$dropZone.removeClass('file-highlighted');\n        },\n        _uploadClick: function (e) {\n            var self = this, $btn = self.$container.find('.fileinput-upload'), $form,\n                isEnabled = !$btn.hasClass('disabled') && $h.isEmpty($btn.attr('disabled'));\n            if (e && e.isDefaultPrevented()) {\n                return;\n            }\n            if (!self.isUploadable) {\n                if (isEnabled && $btn.attr('type') !== 'submit') {\n                    $form = $btn.closest('form');\n                    // downgrade to normal form submit if possible\n                    if ($form.length) {\n                        $form.trigger('submit');\n                    }\n                    e.preventDefault();\n                }\n                return;\n            }\n            e.preventDefault();\n            if (isEnabled) {\n                self.upload();\n            }\n        },\n        _submitForm: function () {\n            var self = this, $el = self.$element, files = $el.get(0).files;\n            if (files && self.minFileCount > 0 && self._getFileCount(files.length) < self.minFileCount) {\n                self._noFilesError({});\n                return false;\n            }\n            return !self._abort({});\n        },\n        _clearPreview: function () {\n            var self = this, $p = self.$preview,\n                $thumbs = self.showUploadedThumbs ? $p.find($h.FRAMES + ':not(.file-preview-success)') : $p.find($h.FRAMES);\n            $thumbs.each(function () {\n                var $thumb = $(this);\n                $thumb.remove();\n                $h.cleanZoomCache($p.find('#zoom-' + $thumb.attr('id')));\n            });\n            if (!self.$preview.find($h.FRAMES).length || !self.showPreview) {\n                self._resetUpload();\n            }\n            self._validateDefaultPreview();\n        },\n        _initSortable: function () {\n            var self = this, $el = self.$preview, settings, selector = '.' + $h.SORT_CSS;\n            if (!window.KvSortable || $el.find(selector).length === 0) {\n                return;\n            }\n            //noinspection JSUnusedGlobalSymbols\n            settings = {\n                handle: '.drag-handle-init',\n                dataIdAttr: 'data-preview-id',\n                draggable: selector,\n                onSort: function (e) {\n                    var oldIndex = e.oldIndex, newIndex = e.newIndex, key, $frame;\n                    self.initialPreview = $h.moveArray(self.initialPreview, oldIndex, newIndex);\n                    self.initialPreviewConfig = $h.moveArray(self.initialPreviewConfig, oldIndex, newIndex);\n                    self.previewCache.init();\n                    for (var i = 0; i < self.initialPreviewConfig.length; i++) {\n                        if (self.initialPreviewConfig[i] !== null) {\n                            key = self.initialPreviewConfig[i].key;\n                            $frame = $(\".kv-file-remove[data-key='\" + key + \"']\").closest($h.FRAMES);\n                            $frame.attr('data-fileindex', 'init_' + i).data('fileindex', 'init_' + i);\n                        }\n                    }\n                    self._raise('filesorted', {\n                        previewId: $(e.item).attr('id'),\n                        'oldIndex': oldIndex,\n                        'newIndex': newIndex,\n                        stack: self.initialPreviewConfig\n                    });\n                }\n            };\n            if ($el.data('kvsortable')) {\n                $el.kvsortable('destroy');\n            }\n            $.extend(true, settings, self.fileActionSettings.dragSettings);\n            $el.kvsortable(settings);\n        },\n        _initPreview: function (isInit) {\n            var self = this, cap = self.initialCaption || '', out;\n            if (!self.previewCache.count()) {\n                self._clearPreview();\n                if (isInit) {\n                    self._setCaption(cap);\n                } else {\n                    self._initCaption();\n                }\n                return;\n            }\n            out = self.previewCache.out();\n            cap = isInit && self.initialCaption ? self.initialCaption : out.caption;\n            self.$preview.html(out.content);\n            self._setInitThumbAttr();\n            self._setCaption(cap);\n            self._initSortable();\n            if (!$h.isEmpty(out.content)) {\n                self.$container.removeClass('file-input-new');\n            }\n        },\n        _getZoomButton: function (type) {\n            var self = this, label = self.previewZoomButtonIcons[type], css = self.previewZoomButtonClasses[type],\n                title = ' title=\"' + (self.previewZoomButtonTitles[type] || '') + '\" ',\n                params = title + (type === 'close' ? ' data-dismiss=\"modal\" aria-hidden=\"true\"' : '');\n            if (type === 'fullscreen' || type === 'borderless' || type === 'toggleheader') {\n                params += ' data-toggle=\"button\" aria-pressed=\"false\" autocomplete=\"off\"';\n            }\n            return '<button type=\"button\" class=\"' + css + ' btn-' + type + '\"' + params + '>' + label + '</button>';\n        },\n        _getModalContent: function () {\n            var self = this;\n            return self._getLayoutTemplate('modal')\n                .replace(/\\{heading}/g, self.msgZoomModalHeading)\n                .replace(/\\{prev}/g, self._getZoomButton('prev'))\n                .replace(/\\{next}/g, self._getZoomButton('next'))\n                .replace(/\\{toggleheader}/g, self._getZoomButton('toggleheader'))\n                .replace(/\\{fullscreen}/g, self._getZoomButton('fullscreen'))\n                .replace(/\\{borderless}/g, self._getZoomButton('borderless'))\n                .replace(/\\{close}/g, self._getZoomButton('close'));\n        },\n        _listenModalEvent: function (event) {\n            var self = this, $modal = self.$modal, getParams = function (e) {\n                return {\n                    sourceEvent: e,\n                    previewId: $modal.data('previewId'),\n                    modal: $modal\n                };\n            };\n            $modal.on(event + '.bs.modal', function (e) {\n                var $btnFull = $modal.find('.btn-fullscreen'), $btnBord = $modal.find('.btn-borderless');\n                self._raise('filezoom' + event, getParams(e));\n                if (event === 'shown') {\n                    $btnBord.removeClass('active').attr('aria-pressed', 'false');\n                    $btnFull.removeClass('active').attr('aria-pressed', 'false');\n                    if ($modal.hasClass('file-zoom-fullscreen')) {\n                        self._maximizeZoomDialog();\n                        if ($h.checkFullScreen()) {\n                            $btnFull.addClass('active').attr('aria-pressed', 'true');\n                        } else {\n                            $btnBord.addClass('active').attr('aria-pressed', 'true');\n                        }\n                    }\n                }\n            });\n        },\n        _initZoom: function () {\n            var self = this, $dialog, modalMain = self._getLayoutTemplate('modalMain'), modalId = '#' + $h.MODAL_ID;\n            self.$modal = $(modalId);\n            if (!self.$modal || !self.$modal.length) {\n                $dialog = $(document.createElement('div')).html(modalMain).insertAfter(self.$container);\n                self.$modal = $('#' + $h.MODAL_ID).insertBefore($dialog);\n                $dialog.remove();\n            }\n            self.$modal.html(self._getModalContent());\n            self._listenModalEvent('show');\n            self._listenModalEvent('shown');\n            self._listenModalEvent('hide');\n            self._listenModalEvent('hidden');\n            self._listenModalEvent('loaded');\n        },\n        _initZoomButtons: function () {\n            var self = this, previewId = self.$modal.data('previewId') || '', $first, $last, $preview = self.$preview,\n                thumbs = $preview.find($h.FRAMES).toArray(), len = thumbs.length,\n                $prev = self.$modal.find('.btn-prev'), $next = self.$modal.find('.btn-next');\n            if (thumbs.length < 2) {\n                $prev.hide();\n                $next.hide();\n                return;\n            } else {\n                $prev.show();\n                $next.show();\n            }\n            if (!len) {\n                return;\n            }\n            $first = $(thumbs[0]);\n            $last = $(thumbs[len - 1]);\n            $prev.removeAttr('disabled');\n            $next.removeAttr('disabled');\n            if ($first.length && $first.attr('id') === previewId) {\n                $prev.attr('disabled', true);\n            }\n            if ($last.length && $last.attr('id') === previewId) {\n                $next.attr('disabled', true);\n            }\n        },\n        _maximizeZoomDialog: function () {\n            var self = this, $modal = self.$modal, $head = $modal.find('.modal-header:visible'),\n                $foot = $modal.find('.modal-footer:visible'), $body = $modal.find('.modal-body'),\n                h = $(window).height(), diff = 0;\n            $modal.addClass('file-zoom-fullscreen');\n            if ($head && $head.length) {\n                h -= $head.outerHeight(true);\n            }\n            if ($foot && $foot.length) {\n                h -= $foot.outerHeight(true);\n            }\n            if ($body && $body.length) {\n                diff = $body.outerHeight(true) - $body.height();\n                h -= diff;\n            }\n            $modal.find('.kv-zoom-body').height(h);\n        },\n        _resizeZoomDialog: function (fullScreen) {\n            var self = this, $modal = self.$modal, $btnFull = $modal.find('.btn-fullscreen'),\n                $btnBord = $modal.find('.btn-borderless');\n            if ($modal.hasClass('file-zoom-fullscreen')) {\n                $h.toggleFullScreen(false);\n                if (!fullScreen) {\n                    if (!$btnFull.hasClass('active')) {\n                        $modal.removeClass('file-zoom-fullscreen');\n                        self.$modal.find('.kv-zoom-body').css('height', self.zoomModalHeight);\n                    } else {\n                        $btnFull.removeClass('active').attr('aria-pressed', 'false');\n                    }\n                } else {\n                    if (!$btnFull.hasClass('active')) {\n                        $modal.removeClass('file-zoom-fullscreen');\n                        self._resizeZoomDialog(true);\n                        if ($btnBord.hasClass('active')) {\n                            $btnBord.removeClass('active').attr('aria-pressed', 'false');\n                        }\n                    }\n                }\n            } else {\n                if (!fullScreen) {\n                    self._maximizeZoomDialog();\n                    return;\n                }\n                $h.toggleFullScreen(true);\n            }\n            $modal.focus();\n        },\n        _setZoomContent: function ($frame, animate) {\n            var self = this, $content, tmplt, body, title, $body, $dataEl, config, pid = $frame.attr('id'),\n                $modal = self.$modal, $prev = $modal.find('.btn-prev'), $next = $modal.find('.btn-next'), $tmp,\n                $btnFull = $modal.find('.btn-fullscreen'), $btnBord = $modal.find('.btn-borderless'), cap, size,\n                $btnTogh = $modal.find('.btn-toggleheader'), $zoomPreview = self.$preview.find('#zoom-' + pid);\n            tmplt = $zoomPreview.attr('data-template') || 'generic';\n            $content = $zoomPreview.find('.kv-file-content');\n            body = $content.length ? $content.html() : '';\n            cap = $frame.data('caption') || '';\n            size = $frame.data('size') || '';\n            title = cap + ' ' + size;\n            $modal.find('.kv-zoom-title').html(title);\n            $body = $modal.find('.kv-zoom-body');\n            $modal.removeClass('kv-single-content');\n            if (animate) {\n                $tmp = $body.clone().insertAfter($body);\n                $body.html(body).hide();\n                $tmp.fadeOut('fast', function () {\n                    $body.fadeIn('fast');\n                    $tmp.remove();\n                });\n            } else {\n                $body.html(body);\n            }\n            config = self.previewZoomSettings[tmplt];\n            if (config) {\n                $dataEl = $body.find('.kv-preview-data');\n                $h.addCss($dataEl, 'file-zoom-detail');\n                $.each(config, function (key, value) {\n                    $dataEl.css(key, value);\n                    if (($dataEl.attr('width') && key === 'width') || ($dataEl.attr('height') && key === 'height')) {\n                        $dataEl.removeAttr(key);\n                    }\n                });\n            }\n            $modal.data('previewId', pid);\n            $h.handler($prev, 'click', function () {\n                self._zoomSlideShow('prev', pid);\n            });\n            $h.handler($next, 'click', function () {\n                self._zoomSlideShow('next', pid);\n            });\n            $h.handler($btnFull, 'click', function () {\n                self._resizeZoomDialog(true);\n            });\n            $h.handler($btnBord, 'click', function () {\n                self._resizeZoomDialog(false);\n            });\n            $h.handler($btnTogh, 'click', function () {\n                var $header = $modal.find('.modal-header'), $floatBar = $modal.find('.modal-body .floating-buttons'),\n                    ht, $actions = $header.find('.kv-zoom-actions'), resize = function (height) {\n                        var $body = self.$modal.find('.kv-zoom-body'), h = self.zoomModalHeight;\n                        if ($modal.hasClass('file-zoom-fullscreen')) {\n                            h = $body.outerHeight(true);\n                            if (!height) {\n                                h = h - $header.outerHeight(true);\n                            }\n                        }\n                        $body.css('height', height ? h + height : h);\n                    };\n                if ($header.is(':visible')) {\n                    ht = $header.outerHeight(true);\n                    $header.slideUp('slow', function () {\n                        $actions.find('.btn').appendTo($floatBar);\n                        resize(ht);\n                    });\n                } else {\n                    $floatBar.find('.btn').appendTo($actions);\n                    $header.slideDown('slow', function () {\n                        resize();\n                    });\n                }\n                $modal.focus();\n            });\n            $h.handler($modal, 'keydown', function (e) {\n                var key = e.which || e.keyCode;\n                if (key === 37 && !$prev.attr('disabled')) {\n                    self._zoomSlideShow('prev', pid);\n                }\n                if (key === 39 && !$next.attr('disabled')) {\n                    self._zoomSlideShow('next', pid);\n                }\n            });\n        },\n        _zoomPreview: function ($btn) {\n            var self = this, $frame, $body = $('body'), $modal = self.$modal;\n            if (!$btn.length) {\n                throw 'Cannot zoom to detailed preview!';\n            }\n            if ($body.length) {\n                $modal.appendTo($body);\n            }\n            $modal.html(self._getModalContent());\n            $frame = $btn.closest($h.FRAMES);\n            self._setZoomContent($frame);\n            $modal.modal('show');\n            self._initZoomButtons();\n        },\n        _zoomSlideShow: function (dir, previewId) {\n            var self = this, $btn = self.$modal.find('.kv-zoom-actions .btn-' + dir), $targFrame, i,\n                thumbs = self.$preview.find($h.FRAMES).toArray(), len = thumbs.length, out;\n            if ($btn.attr('disabled')) {\n                return;\n            }\n            for (i = 0; i < len; i++) {\n                if ($(thumbs[i]).attr('id') === previewId) {\n                    out = dir === 'prev' ? i - 1 : i + 1;\n                    break;\n                }\n            }\n            if (out < 0 || out >= len || !thumbs[out]) {\n                return;\n            }\n            $targFrame = $(thumbs[out]);\n            if ($targFrame.length) {\n                self._setZoomContent($targFrame, true);\n            }\n            self._initZoomButtons();\n            self._raise('filezoom' + dir, {'previewId': previewId, modal: self.$modal});\n        },\n        _initZoomButton: function () {\n            var self = this;\n            self.$preview.find('.kv-file-zoom').each(function () {\n                var $el = $(this);\n                $h.handler($el, 'click', function () {\n                    self._zoomPreview($el);\n                });\n            });\n        },\n        _initPreviewActions: function () {\n            var self = this, $preview = self.$preview, deleteExtraData = self.deleteExtraData || {},\n                btnRemove = $h.FRAMES + ' .kv-file-remove',\n                resetProgress = function () {\n                    var hasFiles = self.isUploadable ? self.previewCache.count() : self.$element.get(0).files.length;\n                    if ($preview.find(btnRemove).length === 0 && !hasFiles) {\n                        self.reset();\n                        self.initialCaption = '';\n                    }\n                };\n            self._initZoomButton();\n            $preview.find(btnRemove).each(function () {\n                var $el = $(this), vUrl = $el.data('url') || self.deleteUrl, vKey = $el.data('key');\n                if ($h.isEmpty(vUrl) || vKey === undefined) {\n                    return;\n                }\n                var $frame = $el.closest($h.FRAMES), cache = self.previewCache.data,\n                    settings, params, index = $frame.data('fileindex'), config, extraData;\n                index = parseInt(index.replace('init_', ''));\n                config = $h.isEmpty(cache.config) && $h.isEmpty(cache.config[index]) ? null : cache.config[index];\n                extraData = $h.isEmpty(config) || $h.isEmpty(config.extra) ? deleteExtraData : config.extra;\n                if (typeof extraData === \"function\") {\n                    extraData = extraData();\n                }\n                params = {id: $el.attr('id'), key: vKey, extra: extraData};\n                settings = $.extend(true, {}, {\n                    url: vUrl,\n                    type: 'POST',\n                    dataType: 'json',\n                    data: $.extend(true, {}, {key: vKey}, extraData),\n                    beforeSend: function (jqXHR) {\n                        self.ajaxAborted = false;\n                        self._raise('filepredelete', [vKey, jqXHR, extraData]);\n                        if (self.ajaxAborted) {\n                            jqXHR.abort();\n                        } else {\n                            $h.addCss($frame, 'file-uploading');\n                            $h.addCss($el, 'disabled');\n                        }\n                    },\n                    success: function (data, textStatus, jqXHR) {\n                        var n, cap;\n                        if ($h.isEmpty(data) || $h.isEmpty(data.error)) {\n                            self.previewCache.init();\n                            index = parseInt(($frame.data('fileindex')).replace('init_', ''));\n                            self.previewCache.unset(index);\n                            n = self.previewCache.count();\n                            cap = n > 0 ? self._getMsgSelected(n) : '';\n                            self._raise('filedeleted', [vKey, jqXHR, extraData]);\n                            self._setCaption(cap);\n                        } else {\n                            params.jqXHR = jqXHR;\n                            params.response = data;\n                            self._showError(data.error, params, 'filedeleteerror');\n                            $frame.removeClass('file-uploading');\n                            $el.removeClass('disabled');\n                            resetProgress();\n                            return;\n                        }\n                        $frame.removeClass('file-uploading').addClass('file-deleted');\n                        $frame.fadeOut('slow', function () {\n                            $h.cleanZoomCache($preview.find('#zoom-' + $frame.attr('id')));\n                            self._clearObjects($frame);\n                            $frame.remove();\n                            resetProgress();\n                            if (!n && self.getFileStack().length === 0) {\n                                self._setCaption('');\n                                self.reset();\n                            }\n                        });\n                    },\n                    error: function (jqXHR, textStatus, errorThrown) {\n                        var op = self.ajaxOperations.deleteThumb, errMsg = self._parseError(op, jqXHR, errorThrown);\n                        params.jqXHR = jqXHR;\n                        params.response = {};\n                        self._showError(errMsg, params, 'filedeleteerror');\n                        $frame.removeClass('file-uploading');\n                        resetProgress();\n                    }\n                }, self.ajaxDeleteSettings);\n                $h.handler($el, 'click', function () {\n                    if (!self._validateMinCount()) {\n                        return false;\n                    }\n                    $.ajax(settings);\n                });\n            });\n        },\n        _clearObjects: function ($el) {\n            $el.find('video audio').each(function () {\n                this.pause();\n                $(this).remove();\n            });\n            $el.find('img object div').each(function () {\n                $(this).remove();\n            });\n        },\n        _clearFileInput: function () {\n            var self = this, $el = self.$element, $srcFrm, $tmpFrm, $tmpEl;\n            self.fileInputCleared = true;\n            if ($h.isEmpty($el.val())) {\n                return;\n            }\n            // Fix for IE ver < 11, that does not clear file inputs. Requires a sequence of steps to prevent IE\n            // crashing but still allow clearing of the file input.\n            if (self.isIE9 || self.isIE10) {\n                $srcFrm = $el.closest('form');\n                $tmpFrm = $(document.createElement('form'));\n                $tmpEl = $(document.createElement('div'));\n                $el.before($tmpEl);\n                if ($srcFrm.length) {\n                    $srcFrm.after($tmpFrm);\n                } else {\n                    $tmpEl.after($tmpFrm);\n                }\n                $tmpFrm.append($el).trigger('reset');\n                $tmpEl.before($el).remove();\n                $tmpFrm.remove();\n            } else { // normal input clear behavior for other sane browsers\n                $el.val('');\n            }\n        },\n        _resetUpload: function () {\n            var self = this;\n            self.uploadCache = {content: [], config: [], tags: [], append: true};\n            self.uploadCount = 0;\n            self.uploadStatus = {};\n            self.uploadLog = [];\n            self.uploadAsyncCount = 0;\n            self.loadedImages = [];\n            self.totalImagesCount = 0;\n            self.$btnUpload.removeAttr('disabled');\n            self._setProgress(0);\n            $h.addCss(self.$progress, 'hide');\n            self._resetErrors(false);\n            self.ajaxAborted = false;\n            self.ajaxRequests = [];\n            self._resetCanvas();\n            self.cacheInitialPreview = {};\n        },\n        _resetCanvas: function () {\n            var self = this;\n            if (self.canvas && self.imageCanvasContext) {\n                self.imageCanvasContext.clearRect(0, 0, self.canvas.width, self.canvas.height);\n            }\n        },\n        _hasInitialPreview: function () {\n            var self = this;\n            return !self.overwriteInitial && self.previewCache.count();\n        },\n        _resetPreview: function () {\n            var self = this, out, cap;\n            if (self.previewCache.count()) {\n                out = self.previewCache.out();\n                self.$preview.html(out.content);\n                self._setInitThumbAttr();\n                cap = self.initialCaption ? self.initialCaption : out.caption;\n                self._setCaption(cap);\n            } else {\n                self._clearPreview();\n                self._initCaption();\n            }\n            if (self.showPreview) {\n                self._initZoom();\n                self._initSortable();\n            }\n        },\n        _clearDefaultPreview: function () {\n            var self = this;\n            self.$preview.find('.file-default-preview').remove();\n        },\n        _validateDefaultPreview: function () {\n            var self = this;\n            if (!self.showPreview || $h.isEmpty(self.defaultPreviewContent)) {\n                return;\n            }\n            self.$preview.html('<div class=\"file-default-preview\">' + self.defaultPreviewContent + '</div>');\n            self.$container.removeClass('file-input-new');\n            self._initClickable();\n        },\n        _resetPreviewThumbs: function (isAjax) {\n            var self = this, out;\n            if (isAjax) {\n                self._clearPreview();\n                self.clearStack();\n                return;\n            }\n            if (self._hasInitialPreview()) {\n                out = self.previewCache.out();\n                self.$preview.html(out.content);\n                self._setInitThumbAttr();\n                self._setCaption(out.caption);\n                self._initPreviewActions();\n            } else {\n                self._clearPreview();\n            }\n        },\n        _getLayoutTemplate: function (t) {\n            var self = this, template = self.layoutTemplates[t];\n            if ($h.isEmpty(self.customLayoutTags)) {\n                return template;\n            }\n            return $h.replaceTags(template, self.customLayoutTags);\n        },\n        _getPreviewTemplate: function (t) {\n            var self = this, template = self.previewTemplates[t];\n            if ($h.isEmpty(self.customPreviewTags)) {\n                return template;\n            }\n            return $h.replaceTags(template, self.customPreviewTags);\n        },\n        _getOutData: function (jqXHR, responseData, filesData) {\n            var self = this;\n            jqXHR = jqXHR || {};\n            responseData = responseData || {};\n            filesData = filesData || self.filestack.slice(0) || {};\n            return {\n                form: self.formdata,\n                files: filesData,\n                filenames: self.filenames,\n                filescount: self.getFilesCount(),\n                extra: self._getExtraData(),\n                response: responseData,\n                reader: self.reader,\n                jqXHR: jqXHR\n            };\n        },\n        _getMsgSelected: function (n) {\n            var self = this, strFiles = n === 1 ? self.fileSingle : self.filePlural;\n            return n > 0 ? self.msgSelected.replace('{n}', n).replace('{files}', strFiles) : self.msgNoFilesSelected;\n        },\n        _getThumbs: function (css) {\n            css = css || '';\n            return this.$preview.find($h.FRAMES + ':not(.file-preview-initial)' + css);\n        },\n        _getExtraData: function (previewId, index) {\n            var self = this, data = self.uploadExtraData;\n            if (typeof self.uploadExtraData === \"function\") {\n                data = self.uploadExtraData(previewId, index);\n            }\n            return data;\n        },\n        _initXhr: function (xhrobj, previewId, fileCount) {\n            var self = this;\n            if (xhrobj.upload) {\n                xhrobj.upload.addEventListener('progress', function (event) {\n                    var pct = 0, total = event.total, position = event.loaded || event.position;\n                    /** @namespace event.lengthComputable */\n                    if (event.lengthComputable) {\n                        pct = Math.floor(position / total * 100);\n                    }\n                    if (previewId) {\n                        self._setAsyncUploadStatus(previewId, pct, fileCount);\n                    } else {\n                        self._setProgress(pct);\n                    }\n                }, false);\n            }\n            return xhrobj;\n        },\n        _ajaxSubmit: function (fnBefore, fnSuccess, fnComplete, fnError, previewId, index) {\n            var self = this, settings;\n            self._raise('filepreajax', [previewId, index]);\n            self._uploadExtra(previewId, index);\n            settings = $.extend(true, {}, {\n                xhr: function () {\n                    var xhrobj = $.ajaxSettings.xhr();\n                    return self._initXhr(xhrobj, previewId, self.getFileStack().length);\n                },\n                url: self.uploadUrl,\n                type: 'POST',\n                dataType: 'json',\n                data: self.formdata,\n                cache: false,\n                processData: false,\n                contentType: false,\n                beforeSend: fnBefore,\n                success: fnSuccess,\n                complete: fnComplete,\n                error: fnError\n            }, self.ajaxSettings);\n            self.ajaxRequests.push($.ajax(settings));\n        },\n        _initUploadSuccess: function (out, $thumb, allFiles) {\n            var self = this, append, data, index, $div, $newCache, content, config, tags, i,\n                mergeArray = function (prop, content) {\n                    if (!(self[prop] instanceof Array)) {\n                        self[prop] = [];\n                    }\n                    if (content && content.length) {\n                        self[prop] = self[prop].concat(content);\n                    }\n                };\n            if (!self.showPreview || typeof out !== 'object' || $.isEmptyObject(out)) {\n                return;\n            }\n            if (out.initialPreview !== undefined && out.initialPreview.length > 0) {\n                self.hasInitData = true;\n                content = out.initialPreview || [];\n                config = out.initialPreviewConfig || [];\n                tags = out.initialPreviewThumbTags || [];\n                append = out.append === undefined || out.append ? true : false;\n                if (content.length > 0 && !$h.isArray(content)) {\n                    content = content.split(self.initialPreviewDelimiter);\n                }\n                self.overwriteInitial = false;\n                mergeArray('initialPreview', content);\n                mergeArray('initialPreviewConfig', config);\n                mergeArray('initialPreviewThumbTags', tags);\n                if ($thumb !== undefined) {\n                    if (!allFiles) {\n                        index = self.previewCache.add(content, config[0], tags[0], append);\n                        data = self.previewCache.get(index, false);\n                        $div = $(document.createElement('div')).html(data).hide().insertAfter($thumb);\n                        $newCache = $div.find('.kv-zoom-cache');\n                        if ($newCache && $newCache.length) {\n                            $newCache.insertAfter($thumb);\n                        }\n                        $thumb.fadeOut('slow', function () {\n                            var $newThumb = $div.find('.file-preview-frame');\n                            if ($newThumb && $newThumb.length) {\n                                $newThumb.insertBefore($thumb).fadeIn('slow').css('display:inline-block');\n                            }\n                            self._initPreviewActions();\n                            self._clearFileInput();\n                            $h.cleanZoomCache(self.$preview.find('#zoom-' + $thumb.attr('id')));\n                            $thumb.remove();\n                            $div.remove();\n                            self._initSortable();\n                        });\n                    } else {\n                        i = $thumb.attr('data-fileindex');\n                        self.uploadCache.content[i] = content[0];\n                        self.uploadCache.config[i] = config[0] || [];\n                        self.uploadCache.tags[i] = tags[0] || [];\n                        self.uploadCache.append = append;\n                    }\n                } else {\n                    self.previewCache.set(content, config, tags, append);\n                    self._initPreview();\n                    self._initPreviewActions();\n                }\n            }\n        },\n        _initSuccessThumbs: function () {\n            var self = this;\n            if (!self.showPreview) {\n                return;\n            }\n            self._getThumbs($h.FRAMES + ' .file-preview-success').each(function () {\n                var $thumb = $(this), $preview = self.$preview, $remove = $thumb.find('.kv-file-remove');\n                $remove.removeAttr('disabled');\n                $h.handler($remove, 'click', function () {\n                    var id = $thumb.attr('id'), out = self._raise('filesuccessremove', [id, $thumb.data('fileindex')]);\n                    $h.cleanMemory($thumb);\n                    if (out === false) {\n                        return;\n                    }\n                    $thumb.fadeOut('slow', function () {\n                        $h.cleanZoomCache($preview.find('#zoom-' + id));\n                        $thumb.remove();\n                        if (!$preview.find($h.FRAMES).length) {\n                            self.reset();\n                        }\n                    });\n                });\n            });\n        },\n        _checkAsyncComplete: function () {\n            var self = this, previewId, i;\n            for (i = 0; i < self.filestack.length; i++) {\n                if (self.filestack[i]) {\n                    previewId = self.previewInitId + \"-\" + i;\n                    if ($.inArray(previewId, self.uploadLog) === -1) {\n                        return false;\n                    }\n                }\n            }\n            return (self.uploadAsyncCount === self.uploadLog.length);\n        },\n        _uploadExtra: function (previewId, index) {\n            var self = this, data = self._getExtraData(previewId, index);\n            if (data.length === 0) {\n                return;\n            }\n            $.each(data, function (key, value) {\n                self.formdata.append(key, value);\n            });\n        },\n        _uploadSingle: function (i, files, allFiles) {\n            var self = this, total = self.getFileStack().length, formdata = new FormData(), outData,\n                previewId = self.previewInitId + \"-\" + i, $thumb, chkComplete, $btnUpload, $btnDelete,\n                hasPostData = self.filestack.length > 0 || !$.isEmptyObject(self.uploadExtraData),\n                $prog = $('#' + previewId).find('.file-thumb-progress'),\n                fnBefore, fnSuccess, fnComplete, fnError, updateUploadLog, params = {id: previewId, index: i};\n            self.formdata = formdata;\n            if (self.showPreview) {\n                $thumb = $('#' + previewId + ':not(.file-preview-initial)');\n                $btnUpload = $thumb.find('.kv-file-upload');\n                $btnDelete = $thumb.find('.kv-file-remove');\n                $prog.removeClass('hide');\n            }\n            if (total === 0 || !hasPostData || ($btnUpload && $btnUpload.hasClass('disabled')) || self._abort(params)) {\n                return;\n            }\n            updateUploadLog = function (i, previewId) {\n                self.updateStack(i, undefined);\n                self.uploadLog.push(previewId);\n                if (self._checkAsyncComplete()) {\n                    self.fileBatchCompleted = true;\n                }\n            };\n            chkComplete = function () {\n                var u = self.uploadCache, $initThumbs, i, j, len, data = self.cacheInitialPreview;\n                if (!self.fileBatchCompleted) {\n                    return;\n                }\n                setTimeout(function () {\n                    if (self.showPreview) {\n                        self.previewCache.set(u.content, u.config, u.tags, u.append);\n                        len = data && data.content ? data.content.length : 0;\n                        if (len) {\n                            for (i = 0; i < u.content.length; i++) {\n                                j = i + len;\n                                data.content[j] = u.content[i];\n                                if (data.config.length) {\n                                    data.config[j] = u.config[i];\n                                }\n                                if (data.tags.length) {\n                                    data.tags[j] = u.tags[i];\n                                }\n                            }\n                            self.initialPreview = data.content;\n                            self.initialPreviewConfig = data.config;\n                            self.initialPreviewThumbTags = data.tags;\n                        } else {\n                            self.initialPreview = u.content;\n                            self.initialPreviewConfig = u.config;\n                            self.initialPreviewThumbTags = u.tags;\n                        }\n                        self.cacheInitialPreview = {};\n                        if (self.hasInitData) {\n                            self._initPreview();\n                            self._initPreviewActions();\n                        }\n                    }\n                    self.unlock();\n                    self._clearFileInput();\n                    $initThumbs = self.$preview.find('.file-preview-initial');\n                    if (self.uploadAsync && $initThumbs.length) {\n                        $h.addCss($initThumbs, $h.SORT_CSS);\n                        self._initSortable();\n                    }\n                    self._raise('filebatchuploadcomplete', [self.filestack, self._getExtraData()]);\n                    self.uploadCount = 0;\n                    self.uploadStatus = {};\n                    self.uploadLog = [];\n                    self._setProgress(101);\n                }, 100);\n            };\n            fnBefore = function (jqXHR) {\n                outData = self._getOutData(jqXHR);\n                self.fileBatchCompleted = false;\n                if (self.showPreview) {\n                    if (!$thumb.hasClass('file-preview-success')) {\n                        self._setThumbStatus($thumb, 'Loading');\n                        $h.addCss($thumb, 'file-uploading');\n                    }\n                    $btnUpload.attr('disabled', true);\n                    $btnDelete.attr('disabled', true);\n                }\n                if (!allFiles) {\n                    self.lock();\n                }\n                self._raise('filepreupload', [outData, previewId, i]);\n                $.extend(true, params, outData);\n                if (self._abort(params)) {\n                    jqXHR.abort();\n                    self._setProgressCancelled();\n                }\n            };\n            fnSuccess = function (data, textStatus, jqXHR) {\n                var pid = self.showPreview && $thumb.attr('id') ? $thumb.attr('id') : previewId;\n                outData = self._getOutData(jqXHR, data);\n                $.extend(true, params, outData);\n                setTimeout(function () {\n                    if ($h.isEmpty(data) || $h.isEmpty(data.error)) {\n                        if (self.showPreview) {\n                            self._setThumbStatus($thumb, 'Success');\n                            $btnUpload.hide();\n                            self._initUploadSuccess(data, $thumb, allFiles);\n                            self._setProgress(101, $prog);\n                        }\n                        self._raise('fileuploaded', [outData, pid, i]);\n                        if (!allFiles) {\n                            self.updateStack(i, undefined);\n                        } else {\n                            updateUploadLog(i, pid);\n                        }\n                    } else {\n                        self._showUploadError(data.error, params);\n                        self._setPreviewError($thumb, i);\n                        if (allFiles) {\n                            updateUploadLog(i, pid);\n                        }\n                    }\n                }, 100);\n            };\n            fnComplete = function () {\n                setTimeout(function () {\n                    if (self.showPreview) {\n                        $btnUpload.removeAttr('disabled');\n                        $btnDelete.removeAttr('disabled');\n                        $thumb.removeClass('file-uploading');\n                    }\n                    if (!allFiles) {\n                        self.unlock(false);\n                        self._clearFileInput();\n                    } else {\n                        chkComplete();\n                    }\n                    self._initSuccessThumbs();\n                }, 100);\n            };\n            fnError = function (jqXHR, textStatus, errorThrown) {\n                var op = self.ajaxOperations.uploadThumb,\n                    errMsg = self._parseError(op, jqXHR, errorThrown, (allFiles ? files[i].name : null));\n                setTimeout(function () {\n                    if (allFiles) {\n                        updateUploadLog(i, previewId);\n                    }\n                    self.uploadStatus[previewId] = 100;\n                    self._setPreviewError($thumb, i);\n                    $.extend(true, params, self._getOutData(jqXHR));\n                    self._setProgress(101, $prog, self.msgAjaxProgressError.replace('{operation}', op));\n                    self._showUploadError(errMsg, params);\n                }, 100);\n            };\n            formdata.append(self.uploadFileAttr, files[i], self.filenames[i]);\n            formdata.append('file_id', i);\n            self._ajaxSubmit(fnBefore, fnSuccess, fnComplete, fnError, previewId, i);\n        },\n        _uploadBatch: function () {\n            var self = this, files = self.filestack, total = files.length, params = {}, fnBefore, fnSuccess, fnError,\n                fnComplete, hasPostData = self.filestack.length > 0 || !$.isEmptyObject(self.uploadExtraData),\n                setAllUploaded;\n            self.formdata = new FormData();\n            if (total === 0 || !hasPostData || self._abort(params)) {\n                return;\n            }\n            setAllUploaded = function () {\n                $.each(files, function (key) {\n                    self.updateStack(key, undefined);\n                });\n                self._clearFileInput();\n            };\n            fnBefore = function (jqXHR) {\n                self.lock();\n                var outData = self._getOutData(jqXHR);\n                if (self.showPreview) {\n                    self._getThumbs().each(function () {\n                        var $thumb = $(this), $btnUpload = $thumb.find('.kv-file-upload'),\n                            $btnDelete = $thumb.find('.kv-file-remove');\n                        if (!$thumb.hasClass('file-preview-success')) {\n                            self._setThumbStatus($thumb, 'Loading');\n                            $h.addCss($thumb, 'file-uploading');\n                        }\n                        $btnUpload.attr('disabled', true);\n                        $btnDelete.attr('disabled', true);\n                    });\n                }\n                self._raise('filebatchpreupload', [outData]);\n                if (self._abort(outData)) {\n                    jqXHR.abort();\n                    self._setProgressCancelled();\n                }\n            };\n            fnSuccess = function (data, textStatus, jqXHR) {\n                /** @namespace data.errorkeys */\n                var outData = self._getOutData(jqXHR, data), $thumbs = self._getThumbs(':not(.file-preview-error)'), key = 0,\n                    keys = $h.isEmpty(data) || $h.isEmpty(data.errorkeys) ? [] : data.errorkeys;\n                if ($h.isEmpty(data) || $h.isEmpty(data.error)) {\n                    self._raise('filebatchuploadsuccess', [outData]);\n                    setAllUploaded();\n                    if (self.showPreview) {\n                        $thumbs.each(function () {\n                            var $thumb = $(this), $btnUpload = $thumb.find('.kv-file-upload');\n                            $thumb.find('.kv-file-upload').hide();\n                            self._setThumbStatus($thumb, 'Success');\n                            $thumb.removeClass('file-uploading');\n                            $btnUpload.removeAttr('disabled');\n                        });\n                        self._initUploadSuccess(data);\n                    } else {\n                        self.reset();\n                    }\n                    self._setProgress(101);\n                } else {\n                    if (self.showPreview) {\n                        $thumbs.each(function () {\n                            var $thumb = $(this), $btnDelete = $thumb.find('.kv-file-remove'),\n                                $btnUpload = $thumb.find('.kv-file-upload');\n                            $thumb.removeClass('file-uploading');\n                            $btnUpload.removeAttr('disabled');\n                            $btnDelete.removeAttr('disabled');\n                            if (keys.length === 0) {\n                                self._setPreviewError($thumb);\n                                return;\n                            }\n                            if ($.inArray(key, keys) !== -1) {\n                                self._setPreviewError($thumb);\n                            } else {\n                                $thumb.find('.kv-file-upload').hide();\n                                self._setThumbStatus($thumb, 'Success');\n                                self.updateStack(key, undefined);\n                            }\n                            key++;\n                        });\n                        self._initUploadSuccess(data);\n                    }\n                    self._showUploadError(data.error, outData, 'filebatchuploaderror');\n                }\n            };\n            fnComplete = function () {\n                self.unlock();\n                self._initSuccessThumbs();\n                self._clearFileInput();\n                self._raise('filebatchuploadcomplete', [self.filestack, self._getExtraData()]);\n            };\n            fnError = function (jqXHR, textStatus, errorThrown) {\n                var outData = self._getOutData(jqXHR), op = self.ajaxOperations.uploadBatch,\n                    errMsg = self._parseError(op, jqXHR, errorThrown);\n                self._showUploadError(errMsg, outData, 'filebatchuploaderror');\n                self.uploadFileCount = total - 1;\n                if (!self.showPreview) {\n                    return;\n                }\n                self._getThumbs().each(function () {\n                    var $thumb = $(this), key = $thumb.attr('data-fileindex');\n                    $thumb.removeClass('file-uploading');\n                    if (self.filestack[key] !== undefined) {\n                        self._setPreviewError($thumb);\n                    }\n                });\n                self._getThumbs().removeClass('file-uploading');\n                self._getThumbs(' .kv-file-upload').removeAttr('disabled');\n                self._getThumbs(' .kv-file-delete').removeAttr('disabled');\n                self._setProgress(101, self.$progress, self.msgAjaxProgressError.replace('{operation}', op));\n            };\n            $.each(files, function (key, data) {\n                if (!$h.isEmpty(files[key])) {\n                    self.formdata.append(self.uploadFileAttr, data, self.filenames[key]);\n                }\n            });\n            self._ajaxSubmit(fnBefore, fnSuccess, fnComplete, fnError);\n        },\n        _uploadExtraOnly: function () {\n            var self = this, params = {}, fnBefore, fnSuccess, fnComplete, fnError;\n            self.formdata = new FormData();\n            if (self._abort(params)) {\n                return;\n            }\n            fnBefore = function (jqXHR) {\n                self.lock();\n                var outData = self._getOutData(jqXHR);\n                self._raise('filebatchpreupload', [outData]);\n                self._setProgress(50);\n                params.data = outData;\n                params.xhr = jqXHR;\n                if (self._abort(params)) {\n                    jqXHR.abort();\n                    self._setProgressCancelled();\n                }\n            };\n            fnSuccess = function (data, textStatus, jqXHR) {\n                var outData = self._getOutData(jqXHR, data);\n                if ($h.isEmpty(data) || $h.isEmpty(data.error)) {\n                    self._raise('filebatchuploadsuccess', [outData]);\n                    self._clearFileInput();\n                    self._initUploadSuccess(data);\n                    self._setProgress(101);\n                } else {\n                    self._showUploadError(data.error, outData, 'filebatchuploaderror');\n                }\n            };\n            fnComplete = function () {\n                self.unlock();\n                self._clearFileInput();\n                self._raise('filebatchuploadcomplete', [self.filestack, self._getExtraData()]);\n            };\n            fnError = function (jqXHR, textStatus, errorThrown) {\n                var outData = self._getOutData(jqXHR), op = self.ajaxOperations.uploadExtra,\n                    errMsg = self._parseError(op, jqXHR, errorThrown);\n                params.data = outData;\n                self._showUploadError(errMsg, outData, 'filebatchuploaderror');\n                self._setProgress(101, self.$progress, self.msgAjaxProgressError.replace('{operation}', op));\n            };\n            self._ajaxSubmit(fnBefore, fnSuccess, fnComplete, fnError);\n        },\n        _initFileActions: function () {\n            var self = this, $preview = self.$preview;\n            if (!self.showPreview) {\n                return;\n            }\n            self._initZoomButton();\n            $preview.find($h.FRAMES + ' .kv-file-remove').each(function () {\n                var $el = $(this), $frame = $el.closest($h.FRAMES), hasError, id = $frame.attr('id'),\n                    ind = $frame.attr('data-fileindex'), n, cap, status;\n                $h.handler($el, 'click', function () {\n                    status = self._raise('filepreremove', [id, ind]);\n                    if (status === false || !self._validateMinCount()) {\n                        return false;\n                    }\n                    hasError = $frame.hasClass('file-preview-error');\n                    $h.cleanMemory($frame);\n                    $frame.fadeOut('slow', function () {\n                        $h.cleanZoomCache($preview.find('#zoom-' + id));\n                        self.updateStack(ind, undefined);\n                        self._clearObjects($frame);\n                        $frame.remove();\n                        if (id && hasError) {\n                            self.$errorContainer.find('li[data-file-id=\"' + id + '\"]').fadeOut('fast', function () {\n                                $(this).remove();\n                                if (!self._errorsExist()) {\n                                    self._resetErrors();\n                                }\n                            });\n                        }\n                        self._clearFileInput();\n                        var filestack = self.getFileStack(true), chk = self.previewCache.count(),\n                            len = filestack.length,\n                            hasThumb = self.showPreview && $preview.find($h.FRAMES).length;\n                        if (len === 0 && chk === 0 && !hasThumb) {\n                            self.reset();\n                        } else {\n                            n = chk + len;\n                            cap = n > 1 ? self._getMsgSelected(n) : (filestack[0] ? self._getFileNames()[0] : '');\n                            self._setCaption(cap);\n                        }\n                        self._raise('fileremoved', [id, ind]);\n                    });\n                });\n            });\n            self.$preview.find($h.FRAMES + ' .kv-file-upload').each(function () {\n                var $el = $(this);\n                $h.handler($el, 'click', function () {\n                    var $frame = $el.closest($h.FRAMES), ind = $frame.attr('data-fileindex');\n                    if (!$frame.hasClass('file-preview-error')) {\n                        self._uploadSingle(ind, self.filestack, false);\n                    }\n                });\n            });\n        },\n        _hideFileIcon: function () {\n            if (this.overwriteInitial) {\n                this.$captionContainer.find('.kv-caption-icon').hide();\n            }\n        },\n        _showFileIcon: function () {\n            this.$captionContainer.find('.kv-caption-icon').show();\n        },\n        _getSize: function (bytes) {\n            var self = this, size = parseFloat(bytes), i, func = self.fileSizeGetter, sizes, out;\n            if (!$.isNumeric(bytes) || !$.isNumeric(size)) {\n                return '';\n            }\n            if (typeof func === 'function') {\n                out = func(size);\n            } else {\n                i = Math.floor(Math.log(size) / Math.log(1024));\n                sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n                out = (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + sizes[i];\n            }\n            return self._getLayoutTemplate('size').replace('{sizeText}', out);\n        },\n        _generatePreviewTemplate: function (cat, data, fname, ftype, previewId, isError, size, frameClass, foot, ind, templ) {\n            var self = this, caption = self.slug(fname), prevContent, zoomContent = '',\n                config = self.previewSettings[cat] || self.defaults.previewSettings[cat],\n                w = config && config.width ? config.width : '', h = config && config.height ? config.height : '',\n                footer = foot || self._renderFileFooter(caption, size, ($h.isEmpty(w) ? 'auto' : w), isError),\n                hasIconSetting = self._getPreviewIcon(fname),\n                forcePrevIcon = hasIconSetting && self.preferIconicPreview,\n                forceZoomIcon = hasIconSetting && self.preferIconicZoomPreview,\n                getContent = function (c, d, zoom, frameCss) {\n                    var id = zoom ? 'zoom-' + previewId : previewId, tmplt = self._getPreviewTemplate(c),\n                        css = (frameClass || '') + ' ' + frameCss;\n                    if (self.frameClass) {\n                        css = self.frameClass + ' ' + css;\n                    }\n                    if (zoom) {\n                        css = css.replace(' ' + $h.SORT_CSS, '');\n                    }\n                    tmplt = self._parseFilePreviewIcon(tmplt, fname);\n                    if (c === 'text') {\n                        d = $h.htmlEncode(d);\n                    }\n                    return tmplt.replace(/\\{previewId}/g, id).replace(/\\{caption}/g, caption)\n                        .replace(/\\{frameClass}/g, css).replace(/\\{type}/g, ftype).replace(/\\{fileindex}/g, ind)\n                        .replace(/\\{width}/g, w).replace(/\\{height}/g, h)\n                        .replace(/\\{footer}/g, footer).replace(/\\{data}/g, d).replace(/\\{template}/g, templ || cat);\n                };\n            ind = ind || previewId.slice(previewId.lastIndexOf('-') + 1);\n            if (self.fileActionSettings.showZoom) {\n                zoomContent = getContent((forceZoomIcon ? 'other' : cat), data, true, 'kv-zoom-thumb');\n            }\n            zoomContent = '\\n' + self._getLayoutTemplate('zoomCache').replace('{zoomContent}', zoomContent);\n            prevContent = getContent((forcePrevIcon ? 'other' : cat), data, false, 'kv-preview-thumb');\n            return prevContent + zoomContent;\n        },\n        _previewDefault: function (file, previewId, isDisabled) {\n            var self = this, $preview = self.$preview;\n            if (!self.showPreview) {\n                return;\n            }\n            var fname = file ? file.name : '', ftype = file ? file.type : '', content, size = file.size,\n                caption = self.slug(fname), isError = isDisabled === true && !self.isUploadable,\n                data = $h.objUrl.createObjectURL(file);\n            self._clearDefaultPreview();\n            content = self._generatePreviewTemplate('other', data, fname, ftype, previewId, isError, size);\n            $preview.append(\"\\n\" + content);\n            self._setThumbAttr(previewId, caption, size);\n            if (isDisabled === true && self.isUploadable) {\n                self._setThumbStatus($('#' + previewId), 'Error');\n            }\n        },\n        _previewFile: function (i, file, theFile, previewId, data) {\n            if (!this.showPreview) {\n                return;\n            }\n            var self = this, cat = self._parseFileType(file), fname = file ? file.name : '', caption = self.slug(fname),\n                types = self.allowedPreviewTypes, mimes = self.allowedPreviewMimeTypes, $preview = self.$preview,\n                chkTypes = types && types.indexOf(cat) >= 0, size = file.size,\n                iData = (cat === 'text' || cat === 'html' || cat === 'image') ? theFile.target.result : data, content,\n                chkMimes = mimes && mimes.indexOf(file.type) !== -1;\n            /** @namespace window.DOMPurify */\n            if (cat === 'html' && self.purifyHtml && window.DOMPurify) {\n                iData = window.DOMPurify.sanitize(iData);\n            }\n            if (chkTypes || chkMimes) {\n                content = self._generatePreviewTemplate(cat, iData, fname, file.type, previewId, false, size);\n                self._clearDefaultPreview();\n                $preview.append(\"\\n\" + content);\n                self._validateImage(previewId, caption, file.type);\n            } else {\n                self._previewDefault(file, previewId);\n            }\n            self._setThumbAttr(previewId, caption, size);\n            self._initSortable();\n        },\n        _setThumbAttr: function (id, caption, size) {\n            var self = this, $frame = $('#' + id);\n            if ($frame.length) {\n                size = size && size > 0 ? self._getSize(size) : '';\n                $frame.data({'caption': caption, 'size': size});\n            }\n        },\n        _setInitThumbAttr: function () {\n            var self = this, data = self.previewCache.data, len = self.previewCache.count(true), config,\n                caption, size, previewId;\n            if (len === 0) {\n                return;\n            }\n            for (var i = 0; i < len; i++) {\n                config = data.config[i];\n                previewId = self.previewInitId + '-' + 'init_' + i;\n                caption = $h.ifSet('caption', config, $h.ifSet('filename', config));\n                size = $h.ifSet('size', config);\n                self._setThumbAttr(previewId, caption, size);\n            }\n        },\n        _slugDefault: function (text) {\n            return $h.isEmpty(text) ? '' : String(text).replace(/[\\-\\[\\]\\/\\{}:;#%=\\(\\)\\*\\+\\?\\\\\\^\\$\\|<>&\"']/g, '_');\n        },\n        _readFiles: function (files) {\n            this.reader = new FileReader();\n            var self = this, $el = self.$element, $preview = self.$preview, reader = self.reader,\n                $container = self.$previewContainer, $status = self.$previewStatus, msgLoading = self.msgLoading,\n                msgProgress = self.msgProgress, previewInitId = self.previewInitId, numFiles = files.length,\n                settings = self.fileTypeSettings, ctr = self.filestack.length, readFile,\n                fileTypes = self.allowedFileTypes, typLen = fileTypes ? fileTypes.length : 0,\n                fileExt = self.allowedFileExtensions, strExt = $h.isEmpty(fileExt) ? '' : fileExt.join(', '),\n                maxPreviewSize = self.maxFilePreviewSize && parseFloat(self.maxFilePreviewSize),\n                canPreview = $preview.length && (!maxPreviewSize || isNaN(maxPreviewSize)),\n                throwError = function (msg, file, previewId, index) {\n                    var p1 = $.extend(true, {}, self._getOutData({}, {}, files), {id: previewId, index: index}),\n                        p2 = {id: previewId, index: index, file: file, files: files};\n                    self._previewDefault(file, previewId, true);\n                    if (self.isUploadable) {\n                        self.addToStack(undefined);\n                        setTimeout(function () {\n                            readFile(index + 1);\n                        }, 100);\n                    }\n                    self._initFileActions();\n                    if (self.removeFromPreviewOnError) {\n                        $('#' + previewId).remove();\n                    }\n                    return self.isUploadable ? self._showUploadError(msg, p1) : self._showError(msg, p2);\n                };\n\n            self.loadedImages = [];\n            self.totalImagesCount = 0;\n\n            $.each(files, function (key, file) {\n                var func = self.fileTypeSettings.image;\n                if (func && func(file.type)) {\n                    self.totalImagesCount++;\n                }\n            });\n            readFile = function (i) {\n                if ($h.isEmpty($el.attr('multiple'))) {\n                    numFiles = 1;\n                }\n                if (i >= numFiles) {\n                    if (self.isUploadable && self.filestack.length > 0) {\n                        self._raise('filebatchselected', [self.getFileStack()]);\n                    } else {\n                        self._raise('filebatchselected', [files]);\n                    }\n                    $container.removeClass('file-thumb-loading');\n                    $status.html('');\n                    return;\n                }\n                var node = ctr + i, previewId = previewInitId + \"-\" + node, isText, isImage, file = files[i], fSizeKB,\n                    caption = file.name ? self.slug(file.name) : '', fileSize = (file.size || 0) / 1000, j, msg,\n                    fileExtExpr = '', previewData = $h.objUrl.createObjectURL(file), typ, chk, typ1, typ2,\n                    fileCount = 0, strTypes = '';\n                if (typLen > 0) {\n                    for (j = 0; j < typLen; j++) {\n                        typ1 = fileTypes[j];\n                        typ2 = self.msgFileTypes[typ1] || typ1;\n                        strTypes += j === 0 ? typ2 : ', ' + typ2;\n                    }\n                }\n                if (caption === false) {\n                    readFile(i + 1);\n                    return;\n                }\n                if (caption.length === 0) {\n                    msg = self.msgInvalidFileName.replace('{name}', $h.htmlEncode(file.name));\n                    self.isError = throwError(msg, file, previewId, i);\n                    return;\n                }\n                if (!$h.isEmpty(fileExt)) {\n                    fileExtExpr = new RegExp('\\\\.(' + fileExt.join('|') + ')$', 'i');\n                }\n                fSizeKB = fileSize.toFixed(2);\n                if (self.maxFileSize > 0 && fileSize > self.maxFileSize) {\n                    msg = self.msgSizeTooLarge.replace('{name}', caption).replace('{size}', fSizeKB)\n                        .replace('{maxSize}', self.maxFileSize);\n                    self.isError = throwError(msg, file, previewId, i);\n                    return;\n                }\n                if (self.minFileSize !== null && fileSize <= $h.getNum(self.minFileSize)) {\n                    msg = self.msgSizeTooSmall.replace('{name}', caption).replace('{size}', fSizeKB)\n                        .replace('{minSize}', self.minFileSize);\n                    self.isError = throwError(msg, file, previewId, i);\n                    return;\n                }\n                if (!$h.isEmpty(fileTypes) && $h.isArray(fileTypes)) {\n                    for (j = 0; j < fileTypes.length; j += 1) {\n                        typ = fileTypes[j];\n                        fileCount += !settings[typ] ? 0 : 1;\n                    }\n                    if (fileCount === 0) {\n                        msg = self.msgInvalidFileType.replace('{name}', caption).replace('{types}', strTypes);\n                        self.isError = throwError(msg, file, previewId, i);\n                        return;\n                    }\n                }\n                if (fileCount === 0 && !$h.isEmpty(fileExt) && $h.isArray(fileExt) && !$h.isEmpty(fileExtExpr)) {\n                    chk = $h.compare(caption, fileExtExpr);\n                    fileCount += $h.isEmpty(chk) ? 0 : chk.length;\n                    if (fileCount === 0) {\n                        msg = self.msgInvalidFileExtension.replace('{name}', caption).replace('{extensions}', strExt);\n                        self.isError = throwError(msg, file, previewId, i);\n                        return;\n                    }\n                }\n                if (!self.showPreview) {\n                    self.addToStack(file);\n                    setTimeout(function () {\n                        readFile(i + 1);\n                    }, 100);\n                    self._raise('fileloaded', [file, previewId, i, reader]);\n                    return;\n                }\n                if (!canPreview && fileSize > maxPreviewSize) {\n                    self.addToStack(file);\n                    $container.addClass('file-thumb-loading');\n                    self._previewDefault(file, previewId);\n                    self._initFileActions();\n                    self._updateFileDetails(numFiles);\n                    readFile(i + 1);\n                    return;\n                }\n                if ($preview.length && FileReader !== undefined) {\n                    $status.html(msgLoading.replace('{index}', i + 1).replace('{files}', numFiles));\n                    $container.addClass('file-thumb-loading');\n                    reader.onerror = function (evt) {\n                        self._errorHandler(evt, caption);\n                    };\n                    reader.onload = function (theFile) {\n                        self._previewFile(i, file, theFile, previewId, previewData);\n                        self._initFileActions();\n                    };\n                    reader.onloadend = function () {\n                        msg = msgProgress.replace('{index}', i + 1).replace('{files}', numFiles)\n                            .replace('{percent}', 50).replace('{name}', caption);\n                        setTimeout(function () {\n                            $status.html(msg);\n                            self._updateFileDetails(numFiles);\n                            readFile(i + 1);\n                        }, 100);\n                        self._raise('fileloaded', [file, previewId, i, reader]);\n                    };\n                    reader.onprogress = function (data) {\n                        if (data.lengthComputable) {\n                            var fact = (data.loaded / data.total) * 100, progress = Math.ceil(fact);\n                            msg = msgProgress.replace('{index}', i + 1).replace('{files}', numFiles)\n                                .replace('{percent}', progress).replace('{name}', caption);\n                            setTimeout(function () {\n                                $status.html(msg);\n                            }, 100);\n                        }\n                    };\n                    isText = settings.text;\n                    isImage = settings.image;\n\n                    if (isText(file.type, caption)) {\n                        reader.readAsText(file, self.textEncoding);\n                    } else {\n                        if (isImage(file.type, caption)) {\n                            reader.readAsDataURL(file);\n                        } else {\n                            reader.readAsArrayBuffer(file);\n                        }\n                    }\n                } else {\n                    self._previewDefault(file, previewId);\n                    setTimeout(function () {\n                        readFile(i + 1);\n                        self._updateFileDetails(numFiles);\n                    }, 100);\n                    self._raise('fileloaded', [file, previewId, i, reader]);\n                }\n                self.addToStack(file);\n            };\n\n            readFile(0);\n            self._updateFileDetails(numFiles, false);\n        },\n        _updateFileDetails: function (numFiles) {\n            var self = this, $el = self.$element, fileStack = self.getFileStack(),\n                name = ($h.isIE(9) && $h.findFileName($el.val())) ||\n                    ($el[0].files[0] && $el[0].files[0].name) || (fileStack.length && fileStack[0].name) || '',\n                label = self.slug(name), n = self.isUploadable ? fileStack.length : numFiles,\n                nFiles = self.previewCache.count() + n, log = n > 1 ? self._getMsgSelected(nFiles) : label;\n            if (self.isError) {\n                self.$previewContainer.removeClass('file-thumb-loading');\n                self.$previewStatus.html('');\n                self.$captionContainer.find('.kv-caption-icon').hide();\n            } else {\n                self._showFileIcon();\n            }\n            self._setCaption(log, self.isError);\n            self.$container.removeClass('file-input-new file-input-ajax-new');\n            if (arguments.length === 1) {\n                self._raise('fileselect', [numFiles, label]);\n            }\n            if (self.previewCache.count()) {\n                self._initPreviewActions();\n            }\n        },\n        _setThumbStatus: function ($thumb, status) {\n            var self = this;\n            if (!self.showPreview) {\n                return;\n            }\n            var icon = 'indicator' + status, msg = icon + 'Title',\n                css = 'file-preview-' + status.toLowerCase(),\n                $indicator = $thumb.find('.file-upload-indicator'),\n                config = self.fileActionSettings;\n            $thumb.removeClass('file-preview-success file-preview-error file-preview-loading');\n            if (status === 'Error') {\n                $thumb.find('.kv-file-upload').attr('disabled', true);\n            }\n            if (status === 'Success') {\n                $thumb.find('.file-drag-handle').remove();\n                $indicator.css('margin-left', 0);\n            }\n            $indicator.html(config[icon]);\n            $indicator.attr('title', config[msg]);\n            $thumb.addClass(css);\n        },\n        _setProgressCancelled: function () {\n            var self = this;\n            self._setProgress(101, self.$progress, self.msgCancelled);\n        },\n        _setProgress: function (p, $el, error) {\n            var self = this, pct = Math.min(p, 100), template = pct < 100 ? self.progressTemplate :\n                    (error ? self.progressErrorTemplate : (p <= 100 ? self.progressTemplate : self.progressCompleteTemplate)),\n                pctLimit = self.progressUploadThreshold;\n            $el = $el || self.$progress;\n            if (!$h.isEmpty(template)) {\n                if (pctLimit && pct > pctLimit && p <= 100) {\n                    var out = template.replace('{percent}', pctLimit).replace('{percent}', pctLimit).replace('{percent}%', self.msgUploadThreshold);\n                    $el.html(out);\n                } else {\n                    $el.html(template.replace(/\\{percent}/g, pct));\n                }\n                if (error) {\n                    $el.find('[role=\"progressbar\"]').html(error);\n                }\n            }\n        },\n        _setFileDropZoneTitle: function () {\n            var self = this, $zone = self.$container.find('.file-drop-zone'), title = self.dropZoneTitle, strFiles;\n            if (self.isClickable) {\n                strFiles = $h.isEmpty(self.$element.attr('multiple')) ? self.fileSingle : self.filePlural;\n                title += self.dropZoneClickTitle.replace('{files}', strFiles);\n            }\n            $zone.find('.' + self.dropZoneTitleClass).remove();\n            if (!self.isUploadable || !self.showPreview || $zone.length === 0 || self.getFileStack().length > 0 || !self.dropZoneEnabled) {\n                return;\n            }\n            if ($zone.find($h.FRAMES).length === 0 && $h.isEmpty(self.defaultPreviewContent)) {\n                $zone.prepend('<div class=\"' + self.dropZoneTitleClass + '\">' + title + '</div>');\n            }\n            self.$container.removeClass('file-input-new');\n            $h.addCss(self.$container, 'file-input-ajax-new');\n        },\n        _setAsyncUploadStatus: function (previewId, pct, total) {\n            var self = this, sum = 0;\n            self._setProgress(pct, $('#' + previewId).find('.file-thumb-progress'));\n            self.uploadStatus[previewId] = pct;\n            $.each(self.uploadStatus, function (key, value) {\n                sum += value;\n            });\n            self._setProgress(Math.floor(sum / total));\n\n        },\n        _validateMinCount: function () {\n            var self = this, len = self.isUploadable ? self.getFileStack().length : self.$element.get(0).files.length;\n            if (self.validateInitialCount && self.minFileCount > 0 && self._getFileCount(len - 1) < self.minFileCount) {\n                self._noFilesError({});\n                return false;\n            }\n            return true;\n        },\n        _getFileCount: function (fileCount) {\n            var self = this, addCount = 0;\n            if (self.validateInitialCount && !self.overwriteInitial) {\n                addCount = self.previewCache.count();\n                fileCount += addCount;\n            }\n            return fileCount;\n        },\n        _getFileName: function (file) {\n            return file && file.name ? this.slug(file.name) : undefined;\n        },\n        _getFileNames: function (skipNull) {\n            var self = this;\n            return self.filenames.filter(function (n) {\n                return (skipNull ? n !== undefined : n !== undefined && n !== null);\n            });\n        },\n        _setPreviewError: function ($thumb, i, val) {\n            var self = this;\n            if (i !== undefined) {\n                self.updateStack(i, val);\n            }\n            if (self.removeFromPreviewOnError) {\n                $thumb.remove();\n            } else {\n                self._setThumbStatus($thumb, 'Error');\n            }\n        },\n        _checkDimensions: function (i, chk, $img, $thumb, fname, type, params) {\n            var self = this, msg, dim, tag = chk === 'Small' ? 'min' : 'max', limit = self[tag + 'Image' + type],\n                $imgEl, isValid;\n            if ($h.isEmpty(limit) || !$img.length) {\n                return;\n            }\n            $imgEl = $img[0];\n            dim = (type === 'Width') ? $imgEl.naturalWidth || $imgEl.width : $imgEl.naturalHeight || $imgEl.height;\n            isValid = chk === 'Small' ? dim >= limit : dim <= limit;\n            if (isValid) {\n                return;\n            }\n            msg = self['msgImage' + type + chk].replace('{name}', fname).replace('{size}', limit);\n            self._showUploadError(msg, params);\n            self._setPreviewError($thumb, i, null);\n        },\n        _validateImage: function (previewId, fname, ftype) {\n            var self = this, $preview = self.$preview, params, w1, w2, $thumb = $preview.find(\"#\" + previewId),\n                i = $thumb.attr('data-fileindex'), $img = $thumb.find('img');\n            fname = fname || 'Untitled';\n            if (!$img.length) {\n                return;\n            }\n            $h.handler($img, 'load', function () {\n                w1 = $thumb.width();\n                w2 = $preview.width();\n                if (w1 > w2) {\n                    $img.css('width', '100%');\n                    $thumb.css('width', '97%');\n                }\n                params = {ind: i, id: previewId};\n                self._checkDimensions(i, 'Small', $img, $thumb, fname, 'Width', params);\n                self._checkDimensions(i, 'Small', $img, $thumb, fname, 'Height', params);\n                if (!self.resizeImage) {\n                    self._checkDimensions(i, 'Large', $img, $thumb, fname, 'Width', params);\n                    self._checkDimensions(i, 'Large', $img, $thumb, fname, 'Height', params);\n                }\n                self._raise('fileimageloaded', [previewId]);\n                self.loadedImages.push({ind: i, img: $img, thumb: $thumb, pid: previewId, typ: ftype});\n                self._validateAllImages();\n            });\n        },\n        _validateAllImages: function () {\n            var self = this, i, counter = {val: 0}, numImgs = self.loadedImages.length;\n            if (numImgs !== self.totalImagesCount) {\n                return;\n            }\n            self._raise('fileimagesloaded');\n            if (!self.resizeImage) {\n                return;\n            }\n            for (i = 0; i < self.loadedImages.length; i++) {\n                self._getResizedImage(self.loadedImages[i], counter, numImgs);\n            }\n        },\n        _getResizedImage: function (config, counter, numImgs) {\n            var self = this, img = config.img, width = img.naturalWidth, height = img.naturalHeight, ratio = 1,\n                maxWidth = self.maxImageWidth || width, maxHeight = self.maxImageHeight || height,\n                isValidImage = !!(width && height), chkWidth, chkHeight, canvas = self.imageCanvas,\n                context = self.imageCanvasContext, type = config.typ, pid = config.pid, ind = config.ind,\n                thumb = config.thumb, errFunc, throwError, msg;\n            errFunc = self.isUploadable ? self._showUploadError : self._showError;\n            throwError = function (msg, params, ev) {\n                errFunc(msg, params, ev);\n                self._setPreviewError(thumb, ind);\n            };\n            if (!self.filestack[ind] || !isValidImage || (width <= maxWidth && height <= maxHeight)) {\n                if (isValidImage && self.filestack[ind]) {\n                    self._raise('fileimageresized', [pid, ind]);\n                }\n                counter.val++;\n                if (counter.val === numImgs) {\n                    self._raise('fileimagesresized');\n                }\n                if (!isValidImage) {\n                    throwError(self.msgImageResizeError, {id: pid, 'index': ind}, 'fileimageresizeerror');\n                    return;\n                }\n            }\n            type = type || self.resizeDefaultImageType;\n            chkWidth = width > maxWidth;\n            chkHeight = height > maxHeight;\n            if (self.resizePreference === 'width') {\n                ratio = chkWidth ? maxWidth / width : (chkHeight ? maxHeight / height : 1);\n            } else {\n                ratio = chkHeight ? maxHeight / height : (chkWidth ? maxWidth / width : 1);\n            }\n            self._resetCanvas();\n            width *= ratio;\n            height *= ratio;\n            canvas.width = width;\n            canvas.height = height;\n            try {\n                context.drawImage(img, 0, 0, width, height);\n                canvas.toBlob(function (blob) {\n                    self.filestack[ind] = blob;\n                    self._raise('fileimageresized', [pid, ind]);\n                    counter.val++;\n                    if (counter.val === numImgs) {\n                        self._raise('fileimagesresized', [undefined, undefined]);\n                    }\n                    if (!(blob instanceof Blob)) {\n                        throwError(self.msgImageResizeError, {id: pid, 'index': ind}, 'fileimageresizeerror');\n                    }\n                }, type, self.resizeQuality);\n            }\n            catch (err) {\n                counter.val++;\n                if (counter.val === numImgs) {\n                    self._raise('fileimagesresized', [undefined, undefined]);\n                }\n                msg = self.msgImageResizeException.replace('{errors}', err.message);\n                throwError(msg, {id: pid, 'index': ind}, 'fileimageresizeexception');\n            }\n        },\n        _initBrowse: function ($container) {\n            var self = this;\n            if (self.showBrowse) {\n                self.$btnFile = $container.find('.btn-file');\n                self.$btnFile.append(self.$element);\n            } else {\n                self.$element.hide();\n            }\n        },\n        _initCaption: function () {\n            var self = this, cap = self.initialCaption || '';\n            if (self.overwriteInitial || $h.isEmpty(cap)) {\n                self.$caption.html('');\n                return false;\n            }\n            self._setCaption(cap);\n            return true;\n        },\n        _setCaption: function (content, isError) {\n            var self = this, title, out, n, cap, stack = self.getFileStack();\n            if (!self.$caption.length) {\n                return;\n            }\n            if (isError) {\n                title = $('<div>' + self.msgValidationError + '</div>').text();\n                n = stack.length;\n                if (n) {\n                    cap = n === 1 && stack[0] ? self._getFileNames()[0] : self._getMsgSelected(n);\n                } else {\n                    cap = self._getMsgSelected(self.msgNo);\n                }\n                out = '<span class=\"' + self.msgValidationErrorClass + '\">' + self.msgValidationErrorIcon +\n                    ($h.isEmpty(content) ? cap : content) + '</span>';\n            } else {\n                if ($h.isEmpty(content)) {\n                    return;\n                }\n                title = $('<div>' + content + '</div>').text();\n                out = self._getLayoutTemplate('fileIcon') + title;\n            }\n            self.$caption.html(out);\n            self.$caption.attr('title', title);\n            self.$captionContainer.find('.file-caption-ellipsis').attr('title', title);\n        },\n        _createContainer: function () {\n            var self = this, $container = $(document.createElement(\"div\"))\n                .attr({\"class\": 'file-input file-input-new'})\n                .html(self._renderMain());\n            self.$element.before($container);\n            self._initBrowse($container);\n            if (self.theme) {\n                $container.addClass('theme-' + self.theme);\n            }\n            return $container;\n        },\n        _refreshContainer: function () {\n            var self = this, $container = self.$container;\n            $container.before(self.$element);\n            $container.html(self._renderMain());\n            self._initBrowse($container);\n        },\n        _renderMain: function () {\n            var self = this, dropCss = (self.isUploadable && self.dropZoneEnabled) ? ' file-drop-zone' : 'file-drop-disabled',\n                close = !self.showClose ? '' : self._getLayoutTemplate('close'),\n                preview = !self.showPreview ? '' : self._getLayoutTemplate('preview')\n                    .replace(/\\{class}/g, self.previewClass)\n                    .replace(/\\{dropClass}/g, dropCss),\n                css = self.isDisabled ? self.captionClass + ' file-caption-disabled' : self.captionClass,\n                caption = self.captionTemplate.replace(/\\{class}/g, css + ' kv-fileinput-caption');\n            return self.mainTemplate.replace(/\\{class}/g, self.mainClass +\n                (!self.showBrowse && self.showCaption ? ' no-browse' : ''))\n                .replace(/\\{preview}/g, preview)\n                .replace(/\\{close}/g, close)\n                .replace(/\\{caption}/g, caption)\n                .replace(/\\{upload}/g, self._renderButton('upload'))\n                .replace(/\\{remove}/g, self._renderButton('remove'))\n                .replace(/\\{cancel}/g, self._renderButton('cancel'))\n                .replace(/\\{browse}/g, self._renderButton('browse'));\n        },\n        _renderButton: function (type) {\n            var self = this, tmplt = self._getLayoutTemplate('btnDefault'), css = self[type + 'Class'],\n                title = self[type + 'Title'], icon = self[type + 'Icon'], label = self[type + 'Label'],\n                status = self.isDisabled ? ' disabled' : '', btnType = 'button';\n            switch (type) {\n                case 'remove':\n                    if (!self.showRemove) {\n                        return '';\n                    }\n                    break;\n                case 'cancel':\n                    if (!self.showCancel) {\n                        return '';\n                    }\n                    css += ' hide';\n                    break;\n                case 'upload':\n                    if (!self.showUpload) {\n                        return '';\n                    }\n                    if (self.isUploadable && !self.isDisabled) {\n                        tmplt = self._getLayoutTemplate('btnLink').replace('{href}', self.uploadUrl);\n                    } else {\n                        btnType = 'submit';\n                    }\n                    break;\n                case 'browse':\n                    if (!self.showBrowse) {\n                        return '';\n                    }\n                    tmplt = self._getLayoutTemplate('btnBrowse');\n                    break;\n                default:\n                    return '';\n            }\n\n            css += type === 'browse' ? ' btn-file' : ' fileinput-' + type + ' fileinput-' + type + '-button';\n            if (!$h.isEmpty(label)) {\n                label = ' <span class=\"' + self.buttonLabelClass + '\">' + label + '</span>';\n            }\n            return tmplt.replace('{type}', btnType).replace('{css}', css).replace('{title}', title)\n                .replace('{status}', status).replace('{icon}', icon).replace('{label}', label);\n        },\n        _renderThumbProgress: function () {\n            return '<div class=\"file-thumb-progress hide\">' + this.progressTemplate.replace(/\\{percent}/g,\n                    '0') + '</div>';\n        },\n        _renderFileFooter: function (caption, size, width, isError) {\n            var self = this, config = self.fileActionSettings, rem = config.showRemove, drg = config.showDrag,\n                upl = config.showUpload, zoom = config.showZoom, out, template = self._getLayoutTemplate('footer'),\n                indicator = isError ? config.indicatorError : config.indicatorNew,\n                title = isError ? config.indicatorErrorTitle : config.indicatorNewTitle;\n            size = self._getSize(size);\n            if (self.isUploadable) {\n                out = template.replace(/\\{actions}/g, self._renderFileActions(upl, rem, zoom, drg, false, false, false))\n                    .replace(/\\{caption}/g, caption).replace(/\\{size}/g, size).replace(/\\{width}/g, width)\n                    .replace(/\\{progress}/g, self._renderThumbProgress()).replace(/\\{indicator}/g, indicator)\n                    .replace(/\\{indicatorTitle}/g, title);\n            } else {\n                out = template.replace(/\\{actions}/g,\n                    self._renderFileActions(false, false, zoom, drg, false, false, false))\n                    .replace(/\\{caption}/g, caption).replace(/\\{size}/g, size).replace(/\\{width}/g, width)\n                    .replace(/\\{progress}/g, '').replace(/\\{indicator}/g, indicator)\n                    .replace(/\\{indicatorTitle}/g, title);\n            }\n            out = $h.replaceTags(out, self.previewThumbTags);\n            return out;\n        },\n        _renderFileActions: function (showUpload, showDelete, showZoom, showDrag, disabled, url, key, isInit) {\n            if (!showUpload && !showDelete && !showZoom && !showDrag) {\n                return '';\n            }\n            var self = this,\n                vUrl = url === false ? '' : ' data-url=\"' + url + '\"',\n                vKey = key === false ? '' : ' data-key=\"' + key + '\"',\n                btnDelete = '', btnUpload = '', btnZoom = '', btnDrag = '', css,\n                template = self._getLayoutTemplate('actions'), config = self.fileActionSettings,\n                otherButtons = self.otherActionButtons.replace(/\\{dataKey}/g, vKey),\n                removeClass = disabled ? config.removeClass + ' disabled' : config.removeClass;\n            if (showDelete) {\n                btnDelete = self._getLayoutTemplate('actionDelete')\n                    .replace(/\\{removeClass}/g, removeClass)\n                    .replace(/\\{removeIcon}/g, config.removeIcon)\n                    .replace(/\\{removeTitle}/g, config.removeTitle)\n                    .replace(/\\{dataUrl}/g, vUrl)\n                    .replace(/\\{dataKey}/g, vKey);\n            }\n            if (showUpload) {\n                btnUpload = self._getLayoutTemplate('actionUpload')\n                    .replace(/\\{uploadClass}/g, config.uploadClass)\n                    .replace(/\\{uploadIcon}/g, config.uploadIcon)\n                    .replace(/\\{uploadTitle}/g, config.uploadTitle);\n            }\n            if (showZoom) {\n                btnZoom = self._getLayoutTemplate('actionZoom')\n                    .replace(/\\{zoomClass}/g, config.zoomClass)\n                    .replace(/\\{zoomIcon}/g, config.zoomIcon)\n                    .replace(/\\{zoomTitle}/g, config.zoomTitle);\n            }\n            if (showDrag && isInit) {\n                css = 'drag-handle-init ' + config.dragClass;\n                btnDrag = self._getLayoutTemplate('actionDrag').replace(/\\{dragClass}/g, css)\n                    .replace(/\\{dragTitle}/g, config.dragTitle)\n                    .replace(/\\{dragIcon}/g, config.dragIcon);\n            }\n            return template.replace(/\\{delete}/g, btnDelete)\n                .replace(/\\{upload}/g, btnUpload)\n                .replace(/\\{zoom}/g, btnZoom)\n                .replace(/\\{drag}/g, btnDrag)\n                .replace(/\\{other}/g, otherButtons);\n        },\n        _browse: function (e) {\n            var self = this;\n            self._raise('filebrowse');\n            if (e && e.isDefaultPrevented()) {\n                return;\n            }\n            if (self.isError && !self.isUploadable) {\n                self.clear();\n            }\n            self.$captionContainer.focus();\n        },\n        _change: function (e) {\n            var self = this, $el = self.$element;\n            if (!self.isUploadable && $h.isEmpty($el.val()) && self.fileInputCleared) { // IE 11 fix\n                self.fileInputCleared = false;\n                return;\n            }\n            self.fileInputCleared = false;\n            var tfiles, msg, total, isDragDrop = arguments.length > 1, isAjaxUpload = self.isUploadable, i = 0, f, n, len,\n                files = isDragDrop ? e.originalEvent.dataTransfer.files : $el.get(0).files, ctr = self.filestack.length,\n                isSingleUpload = $h.isEmpty($el.attr('multiple')), flagSingle = (isSingleUpload && ctr > 0), folders = 0,\n                throwError = function (mesg, file, previewId, index) {\n                    var p1 = $.extend(true, {}, self._getOutData({}, {}, files), {id: previewId, index: index}),\n                        p2 = {id: previewId, index: index, file: file, files: files};\n                    return self.isUploadable ? self._showUploadError(mesg, p1) : self._showError(mesg, p2);\n                };\n            self.reader = null;\n            self._resetUpload();\n            self._hideFileIcon();\n            if (self.isUploadable) {\n                self.$container.find('.file-drop-zone .' + self.dropZoneTitleClass).remove();\n            }\n            if (isDragDrop) {\n                tfiles = [];\n                while (files[i]) {\n                    f = files[i];\n                    if (!f.type && f.size % 4096 === 0) {\n                        folders++;\n                    } else {\n                        tfiles.push(f);\n                    }\n                    i++;\n                }\n            } else {\n                if (e.target.files === undefined) {\n                    tfiles = e.target && e.target.value ? [\n                        {name: e.target.value.replace(/^.+\\\\/, '')}\n                    ] : [];\n                } else {\n                    tfiles = e.target.files;\n                }\n            }\n            if ($h.isEmpty(tfiles) || tfiles.length === 0) {\n                if (!isAjaxUpload) {\n                    self.clear();\n                }\n                self._showFolderError(folders);\n                self._raise('fileselectnone');\n                return;\n            }\n            self._resetErrors();\n            len = tfiles.length;\n            total = self._getFileCount(self.isUploadable ? (self.getFileStack().length + len) : len);\n            if (self.maxFileCount > 0 && total > self.maxFileCount) {\n                if (!self.autoReplace || len > self.maxFileCount) {\n                    n = (self.autoReplace && len > self.maxFileCount) ? len : total;\n                    msg = self.msgFilesTooMany.replace('{m}', self.maxFileCount).replace('{n}', n);\n                    self.isError = throwError(msg, null, null, null);\n                    self.$captionContainer.find('.kv-caption-icon').hide();\n                    self._setCaption('', true);\n                    self.$container.removeClass('file-input-new file-input-ajax-new');\n                    return;\n                }\n                if (total > self.maxFileCount) {\n                    self._resetPreviewThumbs(isAjaxUpload);\n                }\n            } else {\n                if (!isAjaxUpload || flagSingle) {\n                    self._resetPreviewThumbs(false);\n                    if (flagSingle) {\n                        self.clearStack();\n                    }\n                } else {\n                    if (isAjaxUpload && ctr === 0 && (!self.previewCache.count() || self.overwriteInitial)) {\n                        self._resetPreviewThumbs(true);\n                    }\n                }\n            }\n            if (self.isPreviewable) {\n                self._readFiles(tfiles);\n            } else {\n                self._updateFileDetails(1);\n            }\n            self._showFolderError(folders);\n        },\n        _abort: function (params) {\n            var self = this, data;\n            if (self.ajaxAborted && typeof self.ajaxAborted === \"object\" && self.ajaxAborted.message !== undefined) {\n                data = $.extend(true, {}, self._getOutData(), params);\n                data.abortData = self.ajaxAborted.data || {};\n                data.abortMessage = self.ajaxAborted.message;\n                self.cancel();\n                self._setProgress(101, self.$progress, self.msgCancelled);\n                self._showUploadError(self.ajaxAborted.message, data, 'filecustomerror');\n                return true;\n            }\n            return false;\n        },\n        _resetFileStack: function () {\n            var self = this, i = 0, newstack = [], newnames = [];\n            self._getThumbs().each(function () {\n                var $thumb = $(this), ind = $thumb.attr('data-fileindex'),\n                    file = self.filestack[ind];\n                if (ind === -1) {\n                    return;\n                }\n                if (file !== undefined) {\n                    newstack[i] = file;\n                    newnames[i] = self._getFileName(file);\n                    $thumb.attr({\n                        'id': self.previewInitId + '-' + i,\n                        'data-fileindex': i\n                    });\n                    i++;\n                } else {\n                    $thumb.attr({\n                        'id': 'uploaded-' + $h.uniqId(),\n                        'data-fileindex': '-1'\n                    });\n                }\n            });\n            self.filestack = newstack;\n            self.filenames = newnames;\n        },\n        clearStack: function () {\n            var self = this;\n            self.filestack = [];\n            self.filenames = [];\n            return self.$element;\n        },\n        updateStack: function (i, file) {\n            var self = this;\n            self.filestack[i] = file;\n            self.filenames[i] = self._getFileName(file);\n            return self.$element;\n        },\n        addToStack: function (file) {\n            var self = this;\n            self.filestack.push(file);\n            self.filenames.push(self._getFileName(file));\n            return self.$element;\n        },\n        getFileStack: function (skipNull) {\n            var self = this;\n            return self.filestack.filter(function (n) {\n                return (skipNull ? n !== undefined : n !== undefined && n !== null);\n            });\n        },\n        getFilesCount: function () {\n            var self = this, len = self.isUploadable ? self.getFileStack().length : self.$element.get(0).files.length;\n            return self._getFileCount(len);\n        },\n        lock: function () {\n            var self = this;\n            self._resetErrors();\n            self.disable();\n            if (self.showRemove) {\n                $h.addCss(self.$container.find('.fileinput-remove'), 'hide');\n            }\n            if (self.showCancel) {\n                self.$container.find('.fileinput-cancel').removeClass('hide');\n            }\n            self._raise('filelock', [self.filestack, self._getExtraData()]);\n            return self.$element;\n        },\n        unlock: function (reset) {\n            var self = this;\n            if (reset === undefined) {\n                reset = true;\n            }\n            self.enable();\n            if (self.showCancel) {\n                $h.addCss(self.$container.find('.fileinput-cancel'), 'hide');\n            }\n            if (self.showRemove) {\n                self.$container.find('.fileinput-remove').removeClass('hide');\n            }\n            if (reset) {\n                self._resetFileStack();\n            }\n            self._raise('fileunlock', [self.filestack, self._getExtraData()]);\n            return self.$element;\n        },\n        cancel: function () {\n            var self = this, xhr = self.ajaxRequests, len = xhr.length, i;\n            if (len > 0) {\n                for (i = 0; i < len; i += 1) {\n                    self.cancelling = true;\n                    xhr[i].abort();\n                }\n            }\n            self._setProgressCancelled();\n            self._getThumbs().each(function () {\n                var $thumb = $(this), ind = $thumb.attr('data-fileindex');\n                $thumb.removeClass('file-uploading');\n                if (self.filestack[ind] !== undefined) {\n                    $thumb.find('.kv-file-upload').removeClass('disabled').removeAttr('disabled');\n                    $thumb.find('.kv-file-remove').removeClass('disabled').removeAttr('disabled');\n                }\n                self.unlock();\n            });\n            return self.$element;\n        },\n        clear: function () {\n            var self = this, cap;\n            self.$btnUpload.removeAttr('disabled');\n            self._getThumbs().find('video,audio,img').each(function () {\n                $h.cleanMemory($(this));\n            });\n            self._resetUpload();\n            self.clearStack();\n            self._clearFileInput();\n            self._resetErrors(true);\n            self._raise('fileclear');\n            if (self._hasInitialPreview()) {\n                self._showFileIcon();\n                self._resetPreview();\n                self._initPreviewActions();\n                self.$container.removeClass('file-input-new');\n            } else {\n                self._getThumbs().each(function () {\n                    self._clearObjects($(this));\n                });\n                if (self.isUploadable) {\n                    self.previewCache.data = {};\n                }\n                self.$preview.html('');\n                cap = (!self.overwriteInitial && self.initialCaption.length > 0) ? self.initialCaption : '';\n                self.$caption.html(cap);\n                self.$caption.attr('title', '');\n                $h.addCss(self.$container, 'file-input-new');\n                self._validateDefaultPreview();\n            }\n            if (self.$container.find($h.FRAMES).length === 0) {\n                if (!self._initCaption()) {\n                    self.$captionContainer.find('.kv-caption-icon').hide();\n                }\n            }\n            self._hideFileIcon();\n            self._raise('filecleared');\n            self.$captionContainer.focus();\n            self._setFileDropZoneTitle();\n            return self.$element;\n        },\n        reset: function () {\n            var self = this;\n            self._resetPreview();\n            self.$container.find('.fileinput-filename').text('');\n            self._raise('filereset');\n            $h.addCss(self.$container, 'file-input-new');\n            if (self.$preview.find($h.FRAMES).length || self.isUploadable && self.dropZoneEnabled) {\n                self.$container.removeClass('file-input-new');\n            }\n            self._setFileDropZoneTitle();\n            self.clearStack();\n            self.formdata = {};\n            return self.$element;\n        },\n        disable: function () {\n            var self = this;\n            self.isDisabled = true;\n            self._raise('filedisabled');\n            self.$element.attr('disabled', 'disabled');\n            self.$container.find(\".kv-fileinput-caption\").addClass(\"file-caption-disabled\");\n            self.$container.find(\".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button\").attr(\n                \"disabled\",\n                true);\n            self._initDragDrop();\n            return self.$element;\n        },\n        enable: function () {\n            var self = this;\n            self.isDisabled = false;\n            self._raise('fileenabled');\n            self.$element.removeAttr('disabled');\n            self.$container.find(\".kv-fileinput-caption\").removeClass(\"file-caption-disabled\");\n            self.$container.find(\n                \".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button\").removeAttr(\"disabled\");\n            self._initDragDrop();\n            return self.$element;\n        },\n        upload: function () {\n            var self = this, totLen = self.getFileStack().length, params = {}, i, outData, len,\n                hasExtraData = !$.isEmptyObject(self._getExtraData());\n            if (!self.isUploadable || self.isDisabled) {\n                return;\n            }\n            if (self.minFileCount > 0 && self._getFileCount(totLen) < self.minFileCount) {\n                self._noFilesError(params);\n                return;\n            }\n            if (totLen === 0 && !hasExtraData) {\n                self._resetUpload();\n                self._showUploadError(self.msgUploadEmpty);\n                return;\n            }\n            self._resetUpload();\n            self.$progress.removeClass('hide');\n            self.uploadCount = 0;\n            self.uploadStatus = {};\n            self.uploadLog = [];\n            self.lock();\n            self._setProgress(2);\n            if (totLen === 0 && hasExtraData) {\n                self._uploadExtraOnly();\n                return;\n            }\n            len = self.filestack.length;\n            self.hasInitData = false;\n            if (self.uploadAsync) {\n                outData = self._getOutData();\n                self._raise('filebatchpreupload', [outData]);\n                self.fileBatchCompleted = false;\n                self.uploadCache = {content: [], config: [], tags: [], append: true};\n                self.uploadAsyncCount = self.getFileStack().length;\n                for (i = 0; i < len; i++) {\n                    self.uploadCache.content[i] = null;\n                    self.uploadCache.config[i] = null;\n                    self.uploadCache.tags[i] = null;\n                }\n                self.$preview.find('.file-preview-initial').removeClass($h.SORT_CSS);\n                self._initSortable();\n                self.cacheInitialPreview = {\n                    content: self.initialPreview,\n                    config: self.initialPreviewConfig,\n                    tags: self.initialPreviewThumbTags\n                };\n                for (i = 0; i < len; i++) {\n                    if (self.filestack[i] !== undefined) {\n                        self._uploadSingle(i, self.filestack, true);\n                    }\n                }\n                return;\n            }\n            self._uploadBatch();\n            return self.$element;\n        },\n        destroy: function () {\n            var self = this, $cont = self.$container;\n            $cont.find('.file-drop-zone').off();\n            self.$element.insertBefore($cont).off($h.NAMESPACE).removeData();\n            $cont.off().remove();\n            return self.$element;\n        },\n        refresh: function (options) {\n            var self = this, $el = self.$element;\n            options = options ? $.extend(true, {}, self.options, options) : self.options;\n            self.destroy();\n            $el.fileinput(options);\n            if ($el.val()) {\n                $el.trigger('change.fileinput');\n            }\n            return $el;\n        }\n    };\n\n    $.fn.fileinput = function (option) {\n        if (!$h.hasFileAPISupport() && !$h.isIE(9)) {\n            return;\n        }\n        var args = Array.apply(null, arguments), retvals = [];\n        args.shift();\n        this.each(function () {\n            var self = $(this), data = self.data('fileinput'), options = typeof option === 'object' && option,\n                theme = options.theme || self.data('theme'), l = {}, t = {},\n                lang = options.language || self.data('language') || $.fn.fileinput.defaults.language || 'en', opt;\n            if (!data) {\n                if (theme) {\n                    t = $.fn.fileinputThemes[theme] || {};\n                }\n                if (lang !== 'en' && !$h.isEmpty($.fn.fileinputLocales[lang])) {\n                    l = $.fn.fileinputLocales[lang] || {};\n                }\n                opt = $.extend(true, {}, $.fn.fileinput.defaults, t, $.fn.fileinputLocales.en, l, options, self.data());\n                data = new FileInput(this, opt);\n                self.data('fileinput', data);\n            }\n\n            if (typeof option === 'string') {\n                retvals.push(data[option].apply(data, args));\n            }\n        });\n        switch (retvals.length) {\n            case 0:\n                return this;\n            case 1:\n                return retvals[0];\n            default:\n                return retvals;\n        }\n    };\n\n    $.fn.fileinput.defaults = {\n        language: 'en',\n        showCaption: true,\n        showBrowse: true,\n        showPreview: true,\n        showRemove: true,\n        showUpload: true,\n        showCancel: true,\n        showClose: true,\n        showUploadedThumbs: true,\n        browseOnZoneClick: false,\n        autoReplace: false,\n        previewClass: '',\n        captionClass: '',\n        frameClass: 'krajee-default',\n        mainClass: 'file-caption-main',\n        mainTemplate: null,\n        purifyHtml: true,\n        fileSizeGetter: null,\n        initialCaption: '',\n        initialPreview: [],\n        initialPreviewDelimiter: '*$$*',\n        initialPreviewAsData: false,\n        initialPreviewFileType: 'image',\n        initialPreviewConfig: [],\n        initialPreviewThumbTags: [],\n        previewThumbTags: {},\n        initialPreviewShowDelete: true,\n        removeFromPreviewOnError: false,\n        deleteUrl: '',\n        deleteExtraData: {},\n        overwriteInitial: true,\n        previewZoomButtonIcons: {\n            prev: '<i class=\"glyphicon glyphicon-triangle-left\"></i>',\n            next: '<i class=\"glyphicon glyphicon-triangle-right\"></i>',\n            toggleheader: '<i class=\"glyphicon glyphicon-resize-vertical\"></i>',\n            fullscreen: '<i class=\"glyphicon glyphicon-fullscreen\"></i>',\n            borderless: '<i class=\"glyphicon glyphicon-resize-full\"></i>',\n            close: '<i class=\"glyphicon glyphicon-remove\"></i>'\n        },\n        previewZoomButtonClasses: {\n            prev: 'btn btn-navigate',\n            next: 'btn btn-navigate',\n            toggleheader: 'btn btn-default btn-header-toggle',\n            fullscreen: 'btn btn-default',\n            borderless: 'btn btn-default',\n            close: 'btn btn-default'\n        },\n        preferIconicPreview: false,\n        preferIconicZoomPreview: false,\n        allowedPreviewTypes: undefined,\n        allowedPreviewMimeTypes: null,\n        allowedFileTypes: null,\n        allowedFileExtensions: null,\n        defaultPreviewContent: null,\n        customLayoutTags: {},\n        customPreviewTags: {},\n        previewFileIcon: '<i class=\"glyphicon glyphicon-file\"></i>',\n        previewFileIconClass: 'file-other-icon',\n        previewFileIconSettings: {},\n        previewFileExtSettings: {},\n        buttonLabelClass: 'hidden-xs',\n        browseIcon: '<i class=\"glyphicon glyphicon-folder-open\"></i>&nbsp;',\n        browseClass: 'btn btn-primary',\n        removeIcon: '<i class=\"glyphicon glyphicon-trash\"></i>',\n        removeClass: 'btn btn-default',\n        cancelIcon: '<i class=\"glyphicon glyphicon-ban-circle\"></i>',\n        cancelClass: 'btn btn-default',\n        uploadIcon: '<i class=\"glyphicon glyphicon-upload\"></i>',\n        uploadClass: 'btn btn-default',\n        uploadUrl: null,\n        uploadAsync: true,\n        uploadExtraData: {},\n        zoomModalHeight: 480,\n        minImageWidth: null,\n        minImageHeight: null,\n        maxImageWidth: null,\n        maxImageHeight: null,\n        resizeImage: false,\n        resizePreference: 'width',\n        resizeQuality: 0.92,\n        resizeDefaultImageType: 'image/jpeg',\n        minFileSize: 0,\n        maxFileSize: 0,\n        maxFilePreviewSize: 25600, // 25 MB\n        minFileCount: 0,\n        maxFileCount: 0,\n        validateInitialCount: false,\n        msgValidationErrorClass: 'text-danger',\n        msgValidationErrorIcon: '<i class=\"glyphicon glyphicon-exclamation-sign\"></i> ',\n        msgErrorClass: 'file-error-message',\n        progressThumbClass: \"progress-bar progress-bar-success progress-bar-striped active\",\n        progressClass: \"progress-bar progress-bar-success progress-bar-striped active\",\n        progressCompleteClass: \"progress-bar progress-bar-success\",\n        progressErrorClass: \"progress-bar progress-bar-danger\",\n        progressUploadThreshold: 99,\n        previewFileType: 'image',\n        elCaptionContainer: null,\n        elCaptionText: null,\n        elPreviewContainer: null,\n        elPreviewImage: null,\n        elPreviewStatus: null,\n        elErrorContainer: null,\n        errorCloseButton: '<span class=\"close kv-error-close\">&times;</span>',\n        slugCallback: null,\n        dropZoneEnabled: true,\n        dropZoneTitleClass: 'file-drop-zone-title',\n        fileActionSettings: {},\n        otherActionButtons: '',\n        textEncoding: 'UTF-8',\n        ajaxSettings: {},\n        ajaxDeleteSettings: {},\n        showAjaxErrorDetails: true\n    };\n\n    $.fn.fileinputLocales.en = {\n        fileSingle: 'file',\n        filePlural: 'files',\n        browseLabel: 'Browse &hellip;',\n        removeLabel: 'Remove',\n        removeTitle: 'Clear selected files',\n        cancelLabel: 'Cancel',\n        cancelTitle: 'Abort ongoing upload',\n        uploadLabel: 'Upload',\n        uploadTitle: 'Upload selected files',\n        msgNo: 'No',\n        msgNoFilesSelected: 'No files selected',\n        msgCancelled: 'Cancelled',\n        msgZoomModalHeading: 'Detailed Preview',\n        msgSizeTooSmall: 'File \"{name}\" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',\n        msgSizeTooLarge: 'File \"{name}\" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',\n        msgFilesTooLess: 'You must select at least <b>{n}</b> {files} to upload.',\n        msgFilesTooMany: 'Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.',\n        msgFileNotFound: 'File \"{name}\" not found!',\n        msgFileSecured: 'Security restrictions prevent reading the file \"{name}\".',\n        msgFileNotReadable: 'File \"{name}\" is not readable.',\n        msgFilePreviewAborted: 'File preview aborted for \"{name}\".',\n        msgFilePreviewError: 'An error occurred while reading the file \"{name}\".',\n        msgInvalidFileName: 'Invalid or unsupported characters in file name \"{name}\".',\n        msgInvalidFileType: 'Invalid type for file \"{name}\". Only \"{types}\" files are supported.',\n        msgInvalidFileExtension: 'Invalid extension for file \"{name}\". Only \"{extensions}\" files are supported.',\n        msgFileTypes: {\n            'image': 'image',\n            'html': 'HTML',\n            'text': 'text',\n            'video': 'video',\n            'audio': 'audio',\n            'flash': 'flash',\n            'pdf': 'PDF',\n            'object': 'object'\n        },\n        msgUploadAborted: 'The file upload was aborted',\n        msgUploadThreshold: 'Processing...',\n        msgUploadEmpty: 'No valid data available for upload.',\n        msgValidationError: 'Validation Error',\n        msgLoading: 'Loading file {index} of {files} &hellip;',\n        msgProgress: 'Loading file {index} of {files} - {name} - {percent}% completed.',\n        msgSelected: '{n} {files} selected',\n        msgFoldersNotAllowed: 'Drag & drop files only! {n} folder(s) dropped were skipped.',\n        msgImageWidthSmall: 'Width of image file \"{name}\" must be at least {size} px.',\n        msgImageHeightSmall: 'Height of image file \"{name}\" must be at least {size} px.',\n        msgImageWidthLarge: 'Width of image file \"{name}\" cannot exceed {size} px.',\n        msgImageHeightLarge: 'Height of image file \"{name}\" cannot exceed {size} px.',\n        msgImageResizeError: 'Could not get the image dimensions to resize.',\n        msgImageResizeException: 'Error while resizing the image.<pre>{errors}</pre>',\n        msgAjaxError: 'Something went wrong with the {operation} operation. Please try again later!',\n        msgAjaxProgressError: '{operation} failed',\n        ajaxOperations: {\n            deleteThumb: 'file delete',\n            uploadThumb: 'single file upload',\n            uploadBatch: 'batch file upload',\n            uploadExtra: 'form data upload'\n        },\n        dropZoneTitle: 'Drag & drop files here &hellip;',\n        dropZoneClickTitle: '<br>(or click to select {files})',\n        previewZoomButtonTitles: {\n            prev: 'View previous file',\n            next: 'View next file',\n            toggleheader: 'Toggle header',\n            fullscreen: 'Toggle full screen',\n            borderless: 'Toggle borderless mode',\n            close: 'Close detailed preview'\n        }\n    };\n\n    $.fn.fileinput.Constructor = FileInput;\n\n    /**\n     * Convert automatically file inputs with class 'file' into a bootstrap fileinput control.\n     */\n    $(document).ready(function () {\n        var $input = $('input.file[type=file]');\n        if ($input.length) {\n            $input.fileinput();\n        }\n    });\n}));","/*!\n * bootstrap-fileinput v4.3.8\n * http://plugins.krajee.com/file-input\n *\n * Font Awesome icon theme configuration for bootstrap-fileinput. Requires font awesome assets to be loaded.\n *\n * Author: Kartik Visweswaran\n * Copyright: 2014 - 2017, Kartik Visweswaran, Krajee.com\n *\n * Licensed under the BSD 3-Clause\n * https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md\n */\n(function ($) {\n    \"use strict\";\n\n    $.fn.fileinputThemes.fa = {\n        fileActionSettings: {\n            removeIcon: '<i class=\"fa fa-trash text-danger\"></i>',\n            uploadIcon: '<i class=\"fa fa-upload text-info\"></i>',\n            zoomIcon: '<i class=\"fa fa-search-plus\"></i>',\n            dragIcon: '<i class=\"fa fa-bars\"></i>',\n            indicatorNew: '<i class=\"fa fa-hand-o-down text-warning\"></i>',\n            indicatorSuccess: '<i class=\"fa fa-check-circle text-success\"></i>',\n            indicatorError: '<i class=\"fa fa-exclamation-circle text-danger\"></i>',\n            indicatorLoading: '<i class=\"fa fa-hand-o-up text-muted\"></i>'\n        },\n        layoutTemplates: {\n            fileIcon: '<i class=\"fa fa-file kv-caption-icon\"></i> '\n        },\n        previewZoomButtonIcons: {\n            prev: '<i class=\"fa fa-caret-left fa-lg\"></i>',\n            next: '<i class=\"fa fa-caret-right fa-lg\"></i>',\n            toggleheader: '<i class=\"fa fa-arrows-v\"></i>',\n            fullscreen: '<i class=\"fa fa-arrows-alt\"></i>',\n            borderless: '<i class=\"fa fa-external-link\"></i>',\n            close: '<i class=\"fa fa-remove\"></i>'\n        },\n        previewFileIcon: '<i class=\"fa fa-file\"></i>',\n        browseIcon: '<i class=\"fa fa-folder-open\"></i>',\n        removeIcon: '<i class=\"fa fa-trash\"></i>',\n        cancelIcon: '<i class=\"fa fa-ban\"></i>',\n        uploadIcon: '<i class=\"fa fa-upload\"></i>',\n        msgValidationErrorIcon: '<i class=\"fa fa-exclamation-circle\"></i> '\n    };\n})(window.jQuery);\n"]}